Message-ID: <1748077506.16920.1468237655599.JavaMail.crs_adm@ves-ebi-f3.ebi.ac.uk>
Subject: Exported From Confluence
MIME-Version: 1.0
Content-Type: multipart/related; 
	boundary="----=_Part_16919_612776353.1468237655598"

------=_Part_16919_612776353.1468237655598
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-Location: file:///C:/exported.html

<html xmlns:o=3D'urn:schemas-microsoft-com:office:office'
      xmlns:w=3D'urn:schemas-microsoft-com:office:word'
      xmlns:v=3D'urn:schemas-microsoft-com:vml'
      xmlns=3D'urn:w3-org-ns:HTML'>
<head>
    <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dutf-8=
">
    <title>Release coordination documentation</title>
    <!--[if gte mso 9]>
    <xml>
        <o:OfficeDocumentSettings>
            <o:TargetScreenSize>1024x640</o:TargetScreenSize>
            <o:PixelsPerInch>72</o:PixelsPerInch>
            <o:AllowPNG/>
        </o:OfficeDocumentSettings>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>90</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
                <!--
        @page Section1 {
            size: 8.5in 11.0in;
            margin: 1.0in;
            mso-header-margin: .5in;
            mso-footer-margin: .5in;
            mso-paper-source: 0;
        }

        td {
            page-break-inside: avoid;
        }

        tr {
            page-break-after: avoid;
        }

        div.Section1 {
            page: Section1;
        }

        /* Confluence print stylesheet. Common to all themes for print medi=
a */
/* Full of !important until we improve batching for print CSS */

#main {
    padding-bottom: 1em !important; /* The default padding of 6em is too mu=
ch for printouts */
}

body {
    font-family: Arial, Helvetica, FreeSans, sans-serif;
    font-size: 10pt;
    line-height: 1.2;
}

body, #full-height-container, #main, #page, #content, .has-personal-sidebar=
 #content {
    background: #fff    !important;
    color: #000         !important;
    border: 0           !important;
    width: 100%         !important;
    height: auto        !important;
    min-height: auto    !important;
    margin: 0           !important;
    padding: 0          !important;
    display: block      !important;
}

a, a:link, a:visited, a:focus, a:hover, a:active {
    color: #000;
}
#content h1,
#content h2,
#content h3,
#content h4,
#content h5,
#content h6 {
    font-family: Arial, Helvetica, FreeSans, sans-serif;
    page-break-after: avoid;
}
pre {
    font-family: Monaco, "Courier New", monospace;
}

#header,
.aui-header-inner,
#navigation,
#sidebar,
.sidebar,
#personal-info-sidebar,
.ia-fixed-sidebar,
.page-actions,
.navmenu,
.ajs-menu-bar,
.noprint,
.inline-control-link,
.inline-control-link a,
a.show-labels-editor,
.global-comment-actions,
.comment-actions,
.quick-comment-container,
#addcomment {
    display: none !important;
}

.comment .date::before {
    content: none !important; /* remove middot for print view */
}

h1.pagetitle img {
    height: auto;
    width: auto;
}

.print-only {
    display: block;
}
#footer {
    position: relative !important; /* CONF-17506 Place the footer at end of=
 the content */
    margin: 0;
    padding: 0;
    background: none;
    clear: both;
}

#poweredby {
    border-top: none;
    background: none;
}

#poweredby li.print-only {
    display: list-item;
    font-style: italic;
}

#poweredby li.noprint {
    display:none;
}


/* no width controls in print */
.wiki-content .table-wrap,
.wiki-content p,
.panel .codeContent,
.panel .codeContent pre,
.image-wrap {
    overflow: visible !important;
}

/* TODO - should this work? */
#children-section,
#comments-section .comment,
#comments-section .comment .comment-body,
#comments-section .comment .comment-content,
#comments-section .comment p {
    page-break-inside: avoid;
}

#page-children a {
    text-decoration: none;
}

/**
 hide twixies

 the specificity here is a hack because print styles
 are getting loaded before the base styles. */
#comments-section.pageSection .section-header,
#comments-section.pageSection .section-title,
#children-section.pageSection .section-header,
#children-section.pageSection .section-title,
.children-show-hide {
    padding-left: 0;
    margin-left: 0;
}

.children-show-hide.icon {
    display: none;
}

/* personal sidebar */
.has-personal-sidebar #content {
    margin-right: 0px;
}

.has-personal-sidebar #content .pageSection {
    margin-right: 0px;
}
-->
    </style>
</head>
<body>
    <h1>Release coordination documentation</h1>
    <div class=3D"Section1">
        <p><style type=3D"text/css">/*<![CDATA[*/
div.rbtoc1468237653620 {padding: 0px;}
div.rbtoc1468237653620 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1468237653620 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p>
<div class=3D"toc-macro rbtoc1468237653620">=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Preparation">Preparation</=
a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Preparingthisdocumentitsel=
f">Preparing&nbsp;this document itself</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-DeclarationofIntentions">D=
eclaration of Intentions</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Environmentvariables">Envi=
ronment variables</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Updateyourcheckouts">Updat=
e your&nbsp;checkouts</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Comparaservers">Compara se=
rvers</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Guidelinesforthedeletionof=
Databases">Guidelines for the deletion of Databases</a></li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Configurationfile">Configu=
ration file</a></li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Schemapreparation">Schema =
preparation</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Updatetable.sqlandcreatepa=
tchfiles">Update table.sql and create patch files</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Checkthepatchfiles">Check =
the patch files</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Howtopatchadatabasetothela=
testschema">How to patch a database to the latest schema</a></li>=20
</ul> </li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Masterdatabase">Master dat=
abase</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-NCBItaxonomydata">NCBI tax=
onomy data</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Addnewentriestocomparamast=
erdatabase">Add new entries to compara master database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Addmethod_link_species_set=
entriestocomparamasterdatabase">Add method_link_species_set entries to comp=
ara master database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Addnewspeciestophylogeneti=
ctree">Add new species to phylogenetic tree</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finaleditstocomparamasterd=
atabase">Final edits to compara master database</a></li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Production">Production</a>=
</li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Endofproductionwindow">End=
 of production window</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-CreateReleaseDatabase">Cre=
ate Release Database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-MergeDNAdata">Merge DNA da=
ta</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-MergeGeneTrees+Families+NC=
Trees+PatchProjectionsAsHomologies">Merge GeneTrees+Families+NCTrees+PatchP=
rojectionsAsHomologies</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finaldatabasechecks">Final=
 database checks</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Runthehealthchecks">Run th=
e healthchecks</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Testwebserver">Test web se=
rver</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finalhandoverofdatabases[e=
dit]">Final handover of databases [edit]</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Analyze/Optimizeonelasttim=
e">Analyze / Optimize one last time</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Copydatabasestostagingserv=
ers">Copy databases to staging servers</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Filehandover">File handove=
r</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finalbits">Final bits</a><=
/li>=20
</ul> </li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Post-handover">Post-handov=
er</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Updatedocumentationanddiag=
rams[edit]">Update documentation and diagrams [edit]</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Branchthecode">Branch the =
code</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Datadumps">Data dumps</a><=
/li>=20
<li><a href=3D"#Releasecoordinationdocumentation-PatchGRCh37Databases">Patc=
h GRCh37 Databases</a></li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Connectiondetails">Connect=
ion details</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Case1:nodataupdates">Case =
1: no data updates</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Case2:dataupdates">Case 2:=
 data updates</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Comparaupdates:">Compara u=
pdates:</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Finalthings">Final things<=
/a></li>=20
</ul> </li>=20
</ul>=20
</div>
<p></p>
<h1 id=3D"Releasecoordinationdocumentation-Preparation">Preparation</h1>
<h2 id=3D"Releasecoordinationdocumentation-Preparingthisdocumentitself">Pre=
paring&nbsp;<strong>this</strong> document itself</h2>
<p>This document is usually inherited from the previous release cycle and t=
ends to have all the check-boxes ticked. The fastest way to untick them all=
 to start afresh is to go to &quot;Edit...&quot;, then switch over to the X=
ML view (a button on the top right with &lt;&gt; on it), and then perform a=
 mass-replace of&nbsp;&lt;ac:task-status&gt;complete&lt;/ac:task-status&gt;=
 by&nbsp;&lt;ac:task-status&gt;incomplete&lt;/ac:task-status&gt; .</p>
<h2 id=3D"Releasecoordinationdocumentation-DeclarationofIntentions">Declara=
tion of Intentions</h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"4">Once the release coordinato=
r has sent out the email for the declaration of intentions, set up a web pa=
ge with intentions in the Confluence wiki system to allow easy tracking of =
the progress.<a href=3D"/seqdb/confluence/display/EnsCom/Release+plans">Rel=
ease plans</a></li>=20
<li class=3D"checked" data-inline-task-id=3D"5">Ask compara team members of=
 their intentions<br />Compara has one extra day to declare their intention=
s because of the need to know what the genebuilders and associated teams (e=
g wormbase, ensembl genomes) will declare</li>=20
<li class=3D"checked" data-inline-task-id=3D"452"><p>Submit the declaration=
 of intentions on the <a href=3D"http://admin.ensembl.org/index.html" class=
=3D"external-link" rel=3D"nofollow">http://admin.ensembl.org/index.html</a>=
 website</p>=20
<div id=3D"expander-1855575416" class=3D"expand-container">=20
<div id=3D"expander-control-1855575416" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1855575416" class=3D"expand-content">
<ul>
<li>Give a short and meaningful title</li>
<li>Leave &quot;<em>Species affected</em>&quot; to &quot;<em>All species</e=
m>&quot;</li>
<li>Describe the change in &quot;<em>Content</em>&quot;</li>
<li>&quot;<em>Status</em>&quot; is probably &quot;<em>Declared</em>&quot; a=
t this stage, but it may happen that you can already mark it as &quot;<em>H=
anded over</em>&quot;</li>
<li>Change the &quot;<em>Site Type</em>&quot; to &quot;<em>GRCh37</em>&quot=
; if needed</li>
<li>The default values of the remaining fields are fine</li>
</ul>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"451">Discuss with the team whi=
ch declarations are worth being put on the front page (3 at most). For thos=
e, leave &quot;<em>Headline position on the homepage</em>&quot; to &quot;No=
t a headline&quot; but fill in a correct <em>category</em> (&quot;API/Schem=
a changes&quot;, &quot;New alignments&quot;, etc)</li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Environmentvariables">Environmen=
t variables</h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"9"><span>Define $ENSEMBL_CVS_R=
OOT_DIR</span> <br /> <span>This is necessary to run the Hive and is used b=
y many scripts/files in this document. Make sure this is defined in your te=
rminal</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"10"><span>Define $ENSADMIN_PSW=
</span> <br /> <span>The password for the mysql 'ensadmin' user also needed=
 for many scripts</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"511"><p><span>Define $COMPARA_=
REG variable to simplify connecting to databases via registr</span> <span s=
tyle=3D"line-height: 1.4285715;">y</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">export COMPARA_REG=3D&quot;-reg_conf $ENSEMBL_CVS_ROOT_DIR/ense=
mbl-compara/scripts/pipeline/production_reg_conf.pl -reg_type compara -reg_=
alias&quot;</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"513"><p>Define $CURR_ENSEMBL_R=
ELEASE variable to simplify naming of databases</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">export CURR_ENSEMBL_RELEASE=3D`perl -mBio::EnsEMBL::ApiVersion =
-e 'print Bio::EnsEMBL::ApiVersion::software_version().&quot;\n&quot;'`
&nbsp;
=09#&nbsp;make sure that you got the right value (your ensembl checkout has=
 to be up-to-date)
echo $CURR_ENSEMBL_RELEASE
&nbsp;
=09# it is also very handy to have the previous release number in a variabl=
e:
export PREV_ENSEMBL_RELEASE=3D`expr $CURR_ENSEMBL_RELEASE - 1`</pre>=20
</div>
</div></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Updateyourcheckouts"><span>Updat=
e your&nbsp;checkouts</span></h2>
<p><span>Ensure you have up-to-date git checkouts of at least the following=
 repositories, pointing at master branch:<br /> </span></p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"35"><span>ensembl-compara</spa=
n></li>=20
<li class=3D"checked" data-inline-task-id=3D"36"><span>ensembl</span></li>=
=20
<li class=3D"checked" data-inline-task-id=3D"37"><span>ensembl-hive</span><=
/li>=20
<li class=3D"checked" data-inline-task-id=3D"38"><span>ensembl-analysis</sp=
an></li>=20
<li class=3D"checked" data-inline-task-id=3D"39"><span>ensj-healthcheck<br =
/> </span></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Comparaservers">Compara servers<=
/h2>
<p>Check out the current space on the compara servers and delete the last b=
ut one release. <span>Leave the previous release for healthchecks.</span> <=
span>&nbsp;</span>Check with the other compara team members before deleting=
.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"453">Check space on <a href=3D=
"http://admin.ensembl.org/disk_usage/compara.html" class=3D"external-link" =
rel=3D"nofollow">the admin website</a> <br /> <span>&nbsp;</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"514"><p>Ask compara team membe=
rs to tidy up any unwanted databases (run the command below for all compara=
 servers) and inform them of the intention to delete the last but one relea=
se</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>how much space do databases take?</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/db/db-space.pl =
-host compara4 -port 3306 -user ensadmin -password $ENSADMIN_PSW&nbsp;</pre=
>=20
</div>
</div><h3 id=3D"Releasecoordinationdocumentation-Guidelinesforthedeletionof=
Databases"><strong>Guidelines for the deletion of Databases</strong></h3><p=
><strong>****Before dropping any of the databases, they should be backed up=
 and zipped. At least the eHive tables should be backed on the production d=
atabases while research databases should be completely backed up.<br /> </s=
trong> <strong>-</strong>&nbsp;release database: keep only the last one (fo=
r HCs)<strong> <br /> </strong>-&nbsp;production databases: keep the last p=
roduction run of each pipeline on each species-set (e.g. keep the primate E=
PO <strong class=3D"moz-txt-star"> <span class=3D"moz-txt-tag">*</span>and<=
span class=3D"moz-txt-tag">*</span> </strong> the mammal EPO <strong class=
=3D"moz-txt-star"> <span class=3D"moz-txt-tag">*</span>and<span class=3D"mo=
z-txt-tag">*</span> </strong> etc</p></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Configurationfile"><span>Configu=
ration file<br /> </span></h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"528"><p>Update production_reg_=
conf.pl and check back into git:</p>=20
<div id=3D"expander-475398234" class=3D"expand-container">=20
<div id=3D"expander-control-475398234" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click for details</span>=20
</div>=20
<div id=3D"expander-content-475398234" class=3D"expand-content">
<p>Update the registry configuration file $ENSEMBL_CVS_ROOT_DIR/ensembl-com=
para/scripts/pipeline/production_reg_conf.pl that will be used throughout t=
he release process.</p>
<p>Make sure to have edited the release numbers, added external core databa=
ses and fixed name prefixes.</p>
<p>The convention right now (rel.82) is to keep the merged release database=
 on compara5.</p>
<p>DB connection details of production databases (families, nctrees, etc.) =
can be removed from the file until merge.</p>
</div>=20
</div> </li>=20
</ul>=20
<h1 id=3D"Releasecoordinationdocumentation-Schemapreparation">Schema prepar=
ation</h1>=20
<div class=3D"aui-message hint shadowed information-macro">=20
<span class=3D"aui-icon icon-hint">Icon</span>=20
<div class=3D"message-content">=20
<p>All the schema changes must be ready by the handover of the core databas=
es. See <a href=3D"/seqdb/confluence/pages/viewpage.action?pageId=3D2974985=
8">API / Schema changes</a> for the procedure about changing the schema</p>=
=20
</div>=20
</div>=20
<h2 id=3D"Releasecoordinationdocumentation-Updatetable.sqlandcreatepatchfil=
es">Update table.sql and create patch files</h2>
<p>Here we need to prepare table.sql for the new schema and create the rele=
vant patch files. The general procedure is defined in <a href=3D"/seqdb/con=
fluence/pages/viewpage.action?pageId=3D29749858">API / Schema changes</a>.<=
/p>
<p>The other Compara members may have already created patches, so check wit=
h them what's there. At the minimum, there should be the schema version inc=
rease.</p>=20
<div id=3D"expander-503577975" class=3D"expand-container">=20
<div id=3D"expander-control-503577975" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-503577975" class=3D"expand-content">
<p>Update the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/table.sql file and crea=
te any patch files.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"51">Create a patch file for th=
e schema_version</li>=20
<li class=3D"checked" data-inline-task-id=3D"67">Update the schema_version =
in table.sql and delete the other patch INSERT statements</li>=20
<li class=3D"checked" data-inline-task-id=3D"53"><p>Update the schema_versi=
on in the master database</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">UPDATE meta SET meta_value =3D XX WHERE meta_key =3D 'schema_ver=
sion';</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"52">Check if any other patch f=
iles need creating by looking at the Declaration of Intentions and checking=
 with other compara team members</li>=20
<li class=3D"checked" data-inline-task-id=3D"486">Add an INSERT statement f=
or the new schema_version in table.sql and for any other new patches</li>=
=20
</ul>=20
</div>=20
</div>=20
<h2 id=3D"Releasecoordinationdocumentation-Checkthepatchfiles">Check the pa=
tch files</h2>
<p>The schema defined in the current table.sql must be obtainable by patchi=
ng the previous database. There is a shell script to do the comparison</p>=
=20
<div id=3D"expander-1139013175" class=3D"expand-container">=20
<div id=3D"expander-control-1139013175" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1139013175" class=3D"expand-content">
<p>Run the script $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/production/=
schema_diff.sh (you may have to press &quot;y&quot; to validate the patches=
 to apply to the old schema) and check the output. The script relies on sev=
eral things:</p>
<ul>
<li>The API version declared by the Core API (in Bio::EnsEMBL::ApiVersion) =
has been updated</li>
<li>The meta keys in the live database are correct (they should !)</li>
</ul>
<p>The only allowed difference is that peptide_align_feature_XX tables are =
only found in the previous database, not the new one. The script writes 3 f=
iles to the current directory: old_schema.sql, patched_old_schema.sql, and =
new_schema.sql, and automatically runs sdiff. If you need to look at the di=
ff later on, run this:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">sdiff -w 200 -bs patched_old_schema.sql new_schema.sql&nbsp;</p=
re>=20
</div>
</div>
<p><span>git commit table.sql and any patch files</span></p>
</div>=20
</div>=20
<h3 id=3D"Releasecoordinationdocumentation-Howtopatchadatabasetothelatestsc=
hema">How to patch a database to the latest schema</h3>=20
<div id=3D"expander-574728423" class=3D"expand-container">=20
<div id=3D"expander-control-574728423" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-574728423" class=3D"expand-content">
<ul style=3D"list-style-type: square;">
<li><p>Use the following script to detect the what schema the database is o=
n and to apply all the required patches to bring it to the latest schema</p=
>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/schema_patcher.pl --=
host=3D&lt;&gt; --user=3Densadmin --pass=3D${ENSADMIN_PSW} --database=3Dens=
embl_compara_database_${CURR_ENSEMBL_RELEASE}</pre>=20
</div>
</div></li>
</ul>
<p>&nbsp;</p>
</div>=20
</div>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"516">Patch the previous produc=
tion and ancestral databases using the above script</li>=20
</ul>=20
<h1 id=3D"Releasecoordinationdocumentation-Masterdatabase"><span> Master da=
tabase<br /> </span></h1>=20
<div class=3D"aui-message hint shadowed information-macro">=20
<span class=3D"aui-icon icon-hint">Icon</span>=20
<div class=3D"message-content">=20
<p>The Master database can be updated at any time but must be ready before =
the main pipelines start. For more information about its role, consult <a h=
ref=3D"/seqdb/confluence/display/EnsCom/Master+database">Master database</a=
>.</p>=20
</div>=20
</div>=20
<h2 id=3D"Releasecoordinationdocumentation-NCBItaxonomydata">NCBI taxonomy =
data</h2>
<p>The production team updates the ncbi_taxonomy database on livemirror jus=
t before the handover to us (please check that this has been done). We then=
 need to update the tables on our master DB. The current (rel.84) master da=
tabase is mm14_ensembl_compara_master on compara1</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"470"><p>Update the ncbi_taxa_n=
ode and ncbi_taxa_name in the master database</p>=20
<div id=3D"expander-807541663" class=3D"expand-container">=20
<div id=3D"expander-control-807541663" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-807541663" class=3D"expand-content">
<p>The ncbi_taxonomy database is located in <a rel=3D"nofollow">mysql://ens=
-livemirror:3306/ncbi_taxonomy</a></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>mysqldump</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time db_cmd.pl $COMPARA_REG ncbi_taxonomy -executable mysqldump=
 --prepend --extended-insert --prepend --compress ncbi_taxa_node ncbi_taxa_=
name | db_cmd.pl $COMPARA_REG compara_master</pre>=20
</div>
</div>
<p>It usually takes between 30 and 60 seconds.</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"487"><p>Load ensembl_aliases.s=
ql onto the master database</p>=20
<div id=3D"expander-858005182" class=3D"expand-container">=20
<div id=3D"expander-control-858005182" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-858005182" class=3D"expand-content">
The script will report any discrepancies that need to be resolved ie any no=
des which have been deleted from the ncbi_taxonomy database but still have =
entries in the ensembl_aliases.sql file. Check if these have an entry in th=
e species_set_tag table. If not, it is probably safe to delete them. Check =
with other compara team members.
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>load ensembl_aliases</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG compara_master &lt; $ENSEMBL_CVS_ROOT_DI=
R/ensembl-compara/scripts/taxonomy/ensembl_aliases.sql</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"515"><p>Run the CheckTaxon hea=
lthcheck</p>=20
<div id=3D"expander-1489207554" class=3D"expand-container">=20
<div id=3D"expander-control-1489207554" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1489207554" class=3D"expand-content">
<p>Run the CheckTaxon healthcheck early to find any discrepancies between t=
he ncbi_taxon_name table and the core databases (information about how to s=
et up the healthchecks can be found <a href=3D"http://www.ebi.ac.uk/seqdb/c=
onfluence/display/EnsCom/Release+coordination+documentation#Releasecoordina=
tiondocumentation-Runthehealthchecks" class=3D"external-link" rel=3D"nofoll=
ow">here</a>)</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Run healthcheck</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">#cd to your local healthcheck git repo :
cd ensj-healthcheck/
&nbsp;
# make sure you are using the right version of JAVA:
export JAVA_HOME=3D/software/jdk1.6.0_14
&nbsp;
# if you need to recompile (submit to the farm, because you need more memor=
y than is available on the head) :
bsub -I ant clean jar
&nbsp;
# run the healthchecks (submit to the farm, because you need more memory th=
an is available on the head) :
time bsub -I ./run-configurable-testrunner.sh -h compara1 -d mm14_ensembl_c=
ompara_master --host2 ens-staging2 -t org.ensembl.healthcheck.testcase.comp=
ara.CheckTaxon
</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Addnewentriestocomparamasterdata=
base">Add new entries to compara master database</h2>
<p>The current master database is called mm14_ensembl_compara_master on com=
para1. You have to create new genome_dbs and dnafrags when there is a new a=
ssembly or a new species. Any new genome_dbs, dnafrags and method_link_spec=
ies_set_ids need to be added before production starts.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"536"><p>Add a new species / as=
sembly (i.e. a genome_db)</p>=20
<div id=3D"expander-889188328" class=3D"expand-container">=20
<div id=3D"expander-control-889188328" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-889188328" class=3D"expand-content">
<p>You will have to run this script once per new / updated species</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Add genome_db</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/upd=
ate_genome.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipe=
line/production_reg_conf.pl --compara compara_master --species &quot;gadus_=
morhua&quot; --release --collection ensembl</pre>=20
</div>
</div>
<p>If you know that the species won't be ready for this release but the nex=
t one, you need to remove &quot;--release --collection ensembl&quot;. Next =
release, you'll have to rerun update_genome.pl with the --force option</p>
<p>Add the new genome_db_id to the confluence page <a href=3D"/seqdb/conflu=
ence/display/EnsCom/Release+plans">Release plans</a>. This script may take =
a while if the species you are adding is new and has a lot of scaffolds. Yo=
u can check the progress by counting <em>dnafrag</em> entries in the master=
 database:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">SELECT COUNT(*) FROM dnafrag;</pre>=20
</div>
</div>
<p>Add the alias names and other tags to $ENSEMBL_CVS_ROOT_DIR/ensembl-comp=
ara/scripts/taxonomy/ensembl_aliases.sql</p>
<ul>
<li><p>Each new species must have a '<u>ensembl alias name</u>'. It should =
match the &quot;web_name&quot; used by the production team in the &quot;spe=
cies&quot; table of their &quot;ensembl_production&quot; database on stagin=
g1.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>check species/taxa from ensembl_production</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG ensembl_production -sql 'select producti=
on_name, web_name, taxon from species'</pre>=20
</div>
</div></li>
<li><p>Each extant species is anchored to the species tree at a certain tax=
on. This taxon must be described with two fields in the <em>ncbi_taxa_name<=
/em> table. $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/taxonomy/place_sp=
ecies.pl helps in placing the new species in the current compara species tr=
ee and getting those tags</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>check species/taxa from ensembl_production</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/taxonomy/place_sp=
ecies.pl -master_url mysql://ensro@compara1/mm14_ensembl_compara_master -ta=
xon_ids 9940,9361,7994,7918 -collection ensembl</pre>=20
</div>
</div><p>There are two tags to add for each taxon: '<u>ensembl alias name</=
u>': a common name or a &quot;simple English&quot; description of the taxon=
, and '<u>ensembl timetree mya</u>': the age of the taxon. If the <u>ensemb=
l alias name</u> is missing, try wikipedia and google. If <u>ensembl timetr=
ee mya</u> is missing, go to the <a href=3D"http://www.timetree.org/" class=
=3D"external-link" rel=3D"nofollow">TimeTree</a> URL given by the script an=
d check whether the data really is missing, or if they changed the format o=
f their URL / HTML pages.</p></li>
</ul>
<p>For any new species, update the file $ENSEMBL_CVS_ROOT_DIR/ensembl-compa=
ra/scripts/taxonomy/ensembl_aliases.sql to add the new tags and reload the =
file into the master database</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"496"><p>Add in extra non-refer=
ence patches.</p>=20
<div id=3D"expander-1241000903" class=3D"expand-container">=20
<div id=3D"expander-control-1241000903" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1241000903" class=3D"expand-content">
<p>This is currently done when a new patch for either human or mouse is rel=
eased. This may have already been done, please ask.&gt;</p>
<p>Details about the patches can be found here <a href=3D"ftp://ftp.ncbi.nl=
m.nih.gov/genbank/genomes/Eukaryotes/vertebrates_mammals/Homo_sapiens/" cla=
ss=3D"external-link" rel=3D"nofollow">ftp://ftp.ncbi.nlm.nih.gov/genbank/ge=
nomes/Eukaryotes/vertebrates_mammals/Homo_sapiens/</a> e.g. for patch 11:&n=
bsp; <a href=3D"ftp://ftp.ncbi.nlm.nih.gov/genbank/genomes/Eukaryotes/verte=
brates_mammals/Homo_sapiens/GRCh37.p11/README" class=3D"external-link" rel=
=3D"nofollow">ftp://ftp.ncbi.nlm.nih.gov/genbank/genomes/Eukaryotes/vertebr=
ates_mammals/Homo_sapiens/GRCh37.p11/README</a></p>
<p>It is first necessary to find if any patches have been deleted or update=
d since alignments on these need to be deleted from the Compara database. T=
his is done by running the find_assembly_patches.pl script on the new and p=
revious release of the core database</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Find assembly patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/find_ass=
embly_patches.pl -compara &quot;mysql://ensro@compara1/mm14_ensembl_compara=
_master&quot; \
-new_core &quot;mysql://ensro@ens-staging1:3306/homo_sapiens_core_81_38?gro=
up=3Dcore&amp;species=3Dhomo_sapiens&quot; -prev_core &quot;mysql://ensro@e=
ns-livemirror:3306/homo_sapiens_core_80_38?group=3Dcore&amp;species=3Dhomo_=
sapiens&quot;</pre>=20
</div>
</div>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Sample ouptut</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">NEW patches
  CHR_MG3231_PATCH 100440 2015-05-12 16:29:47
  CHR_MG4265_PATCH 100420 2015-05-12 16:29:47
  CHR_MG3609_PATCH 100418 2015-05-12 16:29:47
  CHR_MG117_PATCH 100424 2015-05-12 16:29:47
  CHR_MG3562_PATCH 100416 2015-05-12 16:29:47
  CHR_MG4259_PATCH 100430 2015-05-12 16:29:47
  CHR_MG4255_PATCH 100438 2015-05-12 16:29:47
  CHR_MG4266_PATCH 100422 2015-05-12 16:29:47
  CHR_MG4248_PATCH 100412 2015-05-12 16:29:47
  CHR_MG3561_PATCH 100414 2015-05-12 16:29:47
  CHR_MG4249_PATCH 100434 2015-05-12 16:29:47
  CHR_MG4261_PATCH 100432 2015-05-12 16:29:47
  CHR_MG4254_PATCH 100436 2015-05-12 16:29:47
  CHR_MG4264_PATCH 100428 2015-05-12 16:29:47
CHANGED patches=20
  CHR_MG132_PATCH new=3D100426 2015-05-12 16:29:47        prev=3D100407 201=
4-09-22 11:50:45 dnafrag_id=3D14025314
DELETED patches=20
  CHR_MG4237_PATCH 100405 2014-09-22 11:50:45   dnafrag_id=3D14025313
DnaFrags to delete:
  names: (&quot;CHR_MG132_PATCH&quot;,&quot;CHR_MG4237_PATCH&quot;)
  dnafrag_ids: (14025314,14025313)
Input for create_patch_pairaligner_conf.pl:
--patches chromosome:CHR_MG3231_PATCH,chromosome:CHR_MG4265_PATCH,chromosom=
e:CHR_MG4259_PATCH,chromosome:CHR_MG4266_PATCH,chromosome:CHR_MG4248_PATCH,=
(...)</pre>=20
</div>
</div>
<p>Copy the output to the Intentions for Release page as it will be needed =
to clean-up the alignments</p>
<p>In this case, there are 14 NEW patches, 1 CHANGED patch and 1 DELETED pa=
tch. They can be imported to / deleted from the master database by running =
update_genome.pl with the --force option</p>
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Add patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/upd=
ate_genome.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipe=
line/production_reg_conf.pl --compara compara_master --species human --forc=
e</pre>=20
</div>
</div>
<p>The steps for running the pairwise alignment pipeline for new patches ca=
n be found here: $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/pipelines/READM=
Es/pair_aligner_patches.txt</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"471"><p>Add in the new LRGs</p=
>=20
<div id=3D"expander-320078203" class=3D"expand-container">=20
<div id=3D"expander-control-320078203" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-320078203" class=3D"expand-content">
<p>LRGs are needed by the Family pipeline, and have to be updated every rel=
ease. This is done by running the update_genome.pl script on human with the=
 --force option</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/upd=
ate_genome.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipe=
line/production_reg_conf.pl --compara compara_master --species human --forc=
e</pre>=20
</div>
</div>
<p><strong>Note that the new LRGs may have already been loaded by the previ=
ous step (<em>add in the human patches</em>) as the same update_genome.pl c=
ommand is run</strong></p>
<p>To check if everything loaded OK, compare the output of the following qu=
eries:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/production_reg_conf.pl --reg_type core --reg_alias human -sql =
'select count(*) from seq_region join coord_system cs using(coord_system_id=
) where cs.name=3D&quot;lrg&quot;'
&nbsp;
db_cmd.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline=
/production_reg_conf.pl --reg_alias compara_master -sql 'select count(*) fr=
om dnafrag where coord_system_name=3D&quot;lrg&quot;'</pre>=20
</div>
</div>
<p>they should be the same.</p>
</div>=20
</div> </li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Addmethod_link_species_setentrie=
stocomparamasterdatabase"><span>Add method_link_species_set entries to comp=
ara master database</span></h2>
<p><span>These are usually added by the people that need them, please check=
.</span></p>
<p>The release coordinator (or any team member) should create a new method_=
link_species_set in the master database before starting a new pipeline in o=
rder to get a unique method_link_species_set_id. Ideally they can be create=
d before starting to build the new database although new method_link_specie=
s_sets can be added later on.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"534"><p>Add dna method_link_sp=
ecies_set entries</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type LASTZ_NET --genome_db_id 90,142 --reg_conf $=
ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_conf.p=
l --compara compara_master</pre>=20
</div>
</div><p>If you are sure that the mlss will be ready for the next release, =
you can add --release to the command-line. Otherwise you will have to mark =
the entry manually as OK before merging</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"102"><p>Add synteny method_lin=
k_species_set entries</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type SYNTENY --genome_db_id 90,142 --reg_conf $EN=
SEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_conf.pl =
-compara compara_master</pre>=20
</div>
</div><p>If you are sure that the mlss will be ready for the next release, =
you can add --release to the command-line. Otherwise you will have to mark =
the entry manually as OK before merging</p><p>&nbsp;</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"447"><p>Add species tree metho=
d_link_species_set entry</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type SPECIES_TREE --force --collection &quot;ense=
mbl&quot; --name &quot;species tree&quot; --source &quot;ensembl&quot; --re=
g_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_re=
g_conf.pl -compara compara_master --release</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"1447"><p>Add protein-trees met=
hod_link_species_set entry</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type PROTEIN_TREES --force --collection &quot;ens=
embl&quot; --name &quot;protein trees&quot; --source &quot;ensembl&quot; --=
reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_=
reg_conf.pl -compara compara_master --release</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"2447"><p>Add ncRNA-trees metho=
d_link_species_set entry</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type NC_TREES --force --collection &quot;ensembl&=
quot; --name &quot;nc trees&quot; --source &quot;ensembl&quot; --reg_conf $=
ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_conf.p=
l -compara compara_master --release</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"3447"><p>Add family method_lin=
k_species_set entry</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type FAMILY --force --collection &quot;ensembl&qu=
ot; --name &quot;families&quot; --source &quot;ensembl&quot; --reg_conf $EN=
SEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_conf.pl =
-compara compara_master --release</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"4447"><p>Add pairwise ortholog=
 method_link_species_set entry</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type ENSEMBL_ORTHOLOGUES --force --pw --collectio=
n &quot;ensembl&quot; --source &quot;ensembl&quot; --reg_conf $ENSEMBL_CVS_=
ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_conf.pl -compara c=
ompara_master --release 2&gt; create_mlss.${CURR_ENSEMBL_RELEASE}.ENSEMBL_O=
RTHOLOGUES.err &gt; create_mlss.${CURR_ENSEMBL_RELEASE}.ENSEMBL_ORTHOLOGUES=
.out</pre>=20
</div>
</div><p>Inspect the out and err files for errors</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"5447"><p>Add singleton paralog=
 method_link_species_set entry</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type ENSEMBL_PARALOGUES --force --sg --collection=
 &quot;ensembl&quot; --source &quot;ensembl&quot; --reg_conf $ENSEMBL_CVS_R=
OOT_DIR/ensembl-compara/scripts/pipeline/production_reg_conf.pl -compara co=
mpara_master --release 2&gt; create_mlss.${CURR_ENSEMBL_RELEASE}.ENSEMBL_PA=
RALOGUES.err &gt; create_mlss.${CURR_ENSEMBL_RELEASE}.ENSEMBL_PARALOGUES.ou=
t</pre>=20
</div>
</div><p>Inspect the out and err files for errors</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"537"><p>Reset the URL of reuse=
d mlss_ids<br />In case the same mlss_id can be reused, the pipeline will p=
robably complain that there is already a URL attached to it. You need to re=
set these URLs</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">UPDATE method_link_species_set SET url =3D &quot;&quot; WHERE me=
thod_link_species_set_id IN (&lt;LIST_OF_mlss_ids&gt;);</pre>=20
</div>
</div><p>Usually, this happens when there are no new assemblies, in which c=
ase you need to give the mlss_id of the Family, ncRNA-tree and protein-tree=
 pipelines</p></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Addnewspeciestophylogenetictree"=
>Add new species to phylogenetic tree</h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"116"><p>Add new species to phy=
logenetic tree</p>=20
<div id=3D"expander-516481346" class=3D"expand-container">=20
<div id=3D"expander-control-516481346" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-516481346" class=3D"expand-content">
<p>The easiest way to use this is to use the <a href=3D"http://www.phylowid=
get.org/" class=3D"external-link" rel=3D"nofollow">phylowidget</a>.<br /> P=
aste in the content of $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeli=
ne/species_tree.eukaryotes.topology.nw, select Arrow and select where you w=
ant the new species to go (use ncbi taxonomy or wikipedia etc) eg Gadus mor=
hua.<br /> Then select in the menu &quot;Tree Edit &gt; Add &gt; Sister&quo=
t;. Click on the empty node and edit name (add new name). Leave the branch =
length as it is.<br /> The tree should appear in the Toolbox: save it into =
$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/species_tree_blength=
.nh<br /> git commit</p>
</div>=20
</div> </li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Finaleditstocomparamasterdatabas=
e">Final edits to compara master database</h2>
<p>This runs once all the species have been added / updated.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"517"><p>Compare the staging se=
rvers to the master database</p>=20
<div id=3D"expander-1256716395" class=3D"expand-container">=20
<div id=3D"expander-control-1256716395" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1256716395" class=3D"expand-content">
<p>This script will list the genomes of the staging servers, and compare th=
em to the master database.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;"># Run once in dry-run mode to see the changes
perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/update_master_d=
b.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/prod=
uction_reg_conf.pl --compara compara_master --dry_run</pre>=20
</div>
</div>
<p>** note: The above might throw a warning about not finding any species n=
ame in the ancestral db, this is expected and should not break the test!!</=
p>
<p>Some things (like the genebuild date is different) can be directly chang=
ed by the script (use the --nodry-run option instead). If there is a new as=
sembly / species on the staging servers that is not yet in the master datab=
ase, run update_genome.pl (see above) to add it, and re-run update_master_d=
b.pl to make sure things are solved.</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"518"><p>Healthcheck the master=
 database</p>=20
<div id=3D"expander-1993963923" class=3D"expand-container">=20
<div id=3D"expander-control-1993963923" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1993963923" class=3D"expand-content">
<p>See <a href=3D"/seqdb/confluence/display/EnsCom/JAVA+Healthchecks">JAVA =
Healthchecks</a> and use the ComparaMaster group</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">#cd to your local repo of healthcheck
cd ensj-healthcheck/
$ENSEMBL_CVS_ROOT_DIR/ensj-healthcheck/run-configurable-testrunner.sh -h co=
mpara1 -d mm14_ensembl_compara_master --host2 ens-staging2 -g ComparaMaster=
</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h1 id=3D"Releasecoordinationdocumentation-Production">Production</h1>
<p>Now we can run all our production pipelines</p>
<h1 id=3D"Releasecoordinationdocumentation-Endofproductionwindow">End of pr=
oduction window</h1>
<h2 id=3D"Releasecoordinationdocumentation-CreateReleaseDatabase">Create Re=
lease Database</h2>
<p>Create the new database for the new release and add it to your registry =
configuration file. Use the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/sql/table=
.sql file to create the tables and populate the database with the relevant =
primary data and genomic alignments that can be reused from the previous re=
lease. This can be done with the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/populate_new_database.pl script.&nbsp; It requires the master =
database, the previous released database and the fresh new database with th=
e tables already created. The script will copy relevant data from the maste=
r and the old database into the new one.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"348"><p>&gt;Create new databas=
e</p>=20
<div id=3D"expander-837793539" class=3D"expand-container">=20
<div id=3D"expander-control-837793539" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-837793539" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Create database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG compara_curr -sql &quot;CREATE DATABASE&=
quot;
db_cmd.pl $COMPARA_REG compara_curr &lt; $ENSEMBL_CVS_ROOT_DIR/ensembl-comp=
ara/sql/table.sql=20
</pre>=20
</div>
</div>
</div>=20
</div> <p>&nbsp;</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"538"><p>Populate the new datab=
ase</p>=20
<div id=3D"expander-498217371" class=3D"expand-container">=20
<div id=3D"expander-control-498217371" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-498217371" class=3D"expand-content">
<p>Before you start copying, make a dry run of the populate_new_database.pl=
 with -intentions flag to review the list of mlss_ids to be copied:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>populate_new_database intentions</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/populate=
_new_database.pl --reg-conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/p=
ipeline/production_reg_conf.pl \=20
--master compara_master --old compara_prev --new compara_curr --intentions =
&gt; populate_new_database.intentions</pre>=20
</div>
</div>
<p>This normally takes less than a minute and produces a long list.</p>
<p>If you believe some of the MLSS or SS entries should NOT be copied, conn=
ect to the master database and change the last_release of the unwanted entr=
ies to the previous release number. <span style=3D"line-height: 1.4285715;"=
>Conversely, if you want to prepare some new MLSS or SS entries to be copie=
d (e.g. the newly run pipelines), change the first_release of the wanted en=
tries to the current release number.</span></p>
<p><span style=3D"line-height: 1.4285715;"> <br /> </span></p>
<p><span style=3D"line-height: 1.4285715;">NB: OLD INSTRUCTIONS FOR PRE-fir=
st_release/last_release API: <em>There are cases where the mlss does not ch=
ange but the underlying data does, e.g. the &quot;patch-to-ref&quot; alignm=
ent (H.sap-H.sap lastz-patch and M.mus-M.mus lastz-patch). These have a mls=
s_id of 556 (H.sap)&nbsp; and 624 (M.mus) and are currently set in the skip=
_mlss. If there are no new patches, this needs to be removed to allow the e=
xisting data to be copied. If there are new patches, please ensure the 'ski=
p_mlss' is set in the meta table. However, the entry in the method_link_spe=
cies_set table will not be copied and will need to be added manually.</em> =
</span></p>
<p>Start the copying:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>populate_new_database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">bsub -q yesterday -R &quot;select[mem&gt;20000] rusage[mem=3D20=
000]&quot; -M20000 -Is bash
time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/populate_new_da=
tabase.pl \
    --reg-conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/produ=
ction_reg_conf.pl --master compara_master --old compara_prev --new compara_=
curr &gt; populate_new_database.out</pre>=20
</div>
</div>=20
<div id=3D"expander-17854401" class=3D"expand-container">=20
<div id=3D"expander-control-17854401" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-17854401" class=3D"expand-content">
<p>took 3 hours for rel.pre57 (copied from rel.56)<br /> took 3 hours for r=
el.57 (copied from rel.pre57)<br /> took 2:15 hours for rel.58 (copied from=
 rel.57)<br /> took 2:09 hours for rel.59 (copied from rel.58)<br /> took 3=
 hours for rel. 60 (copied from rel.59)<br /> rel.64:&nbsp;2.6h<br /> rel.6=
5:&nbsp;2.5h<br /> rel.66:&nbsp;4.8h<br /> rel.67:&nbsp;2.1h (launched from=
 compara3)<br /> rel.68:&nbsp;1h40m (run on compara3)<br /> rel.69:&nbsp;2.=
5h<br /> rel.70:&nbsp;~3.5h (compara1 was slow)<br /> rel.71:&nbsp;4.1h (co=
mpara3)<br /> rel.72: 5.1h (compara3)<br /> rel.73: 5.5h (compara2)<br /> r=
el.74: 2h:3' (compara3)<br /> rel.75: 5.5h (compara5)<br /> rel.77: 9.7h (c=
ompara5)<br /> rel.78: 6.0h (compara4)<br /> rel.79:<br /> rel.80:<br /> re=
l.81: 6h (compara5)&nbsp;</p>
<p>rel.82: 5.5h (compara5)</p>
<p><span>rel.83: 4.8h (compara5)</span></p>
<p><span>rel.85: 7.5h (compara5)</span></p>
</div>=20
</div>=20
<p>If new method_link_species_sets are added in the master after this, you =
use this script again to copy the new relevant data. In such case, you will=
 have to:</p>
<p>&nbsp;- skip the old_database in order to avoid trying to copy the dna-d=
na alignments and syntenies again</p>
<p>&nbsp;- empty ncbi_taxa_name before running</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>populate_new_database from master only</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/populate=
_new_database.pl \
    --reg-conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/produ=
ction_reg_conf.pl --master compara_master --new compara_curr</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul> </li>=20
<li class=3D"checked" data-inline-task-id=3D"473"><p>Delete any pairwise al=
ignments on non-reference patches that have been DELETED or UPDATED.</p>=20
<div id=3D"expander-1267993999" class=3D"expand-container">=20
<div id=3D"expander-control-1267993999" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1267993999" class=3D"expand-content">
<p>Find the output of <span style=3D"line-height: 1.4285715;">find_assembly=
_patches.pl script that you ran previously (usually for Human and Mouse) an=
d combine their &quot;Dnafrags to delete&quot; into one common list:</span>=
</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>delete patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">DNAFRAGS_2_DELETE=3D&quot;(14025314,14025313)&quot;
&nbsp;
db_cmd.pl $COMPARA_REG compara_curr -sql &quot;SELECT count(*) FROM genomic=
_align ga1, genomic_align ga2, genomic_align_block gab WHERE ga1.genomic_al=
ign_block_id =3D ga2.genomic_align_block_id AND ga1.genomic_align_id !=3D g=
a2.genomic_align_id AND  ga1.genomic_align_block_id =3D gab.genomic_align_b=
lock_id AND ga1.dnafrag_id in $DNAFRAGS_2_DELETE&quot;
&nbsp;
db_cmd.pl $COMPARA_REG compara_curr -sql &quot;DELETE ga1, ga2, gab FROM ge=
nomic_align ga1, genomic_align ga2, genomic_align_block gab WHERE ga1.genom=
ic_align_block_id =3D ga2.genomic_align_block_id AND ga1.genomic_align_id !=
=3D ga2.genomic_align_id AND  ga1.genomic_align_block_id =3D gab.genomic_al=
ign_block_id AND ga1.dnafrag_id in $DNAFRAGS_2_DELETE&quot;</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"520"><p>Run healthchecks on th=
e release database</p>=20
<div id=3D"expander-972630293" class=3D"expand-container">=20
<div id=3D"expander-control-972630293" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-972630293" class=3D"expand-content">
<p>Run the healthchecks to make sure the the release database is consistent=
 after the initial population of data.</p>
<p>Click <a href=3D"http://www.ebi.ac.uk/seqdb/confluence/display/EnsCom/Re=
lease+coordination+documentation#Releasecoordinationdocumentation-Runthehea=
lthchecks" class=3D"external-link" rel=3D"nofollow">here</a> for how to set=
up and run the healthchecks</p>
<p>Run the compara_external_foreign_keys healthcheck</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>healthcheck</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cd $ENSEMBL_CVS_ROOT_DIR/ensj-healthcheck
&nbsp;
# make sure you are using the right version of JAVA:
export JAVA_HOME=3D/software/jdk1.6.0_14
=20
# if you need to recompile (submit to the farm, because you need more memor=
y than is available on the head) :
bsub -I ant clean jar

# some tests need more memory than the farm3's default:
time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rusage[mem=3D80=
00]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d lg4_ensembl_co=
mpara_81 --host2 ens-staging2 -g ComparaShared</pre>=20
</div>
</div>=20
<div id=3D"expander-1879868696" class=3D"expand-container">=20
<div id=3D"expander-control-1879868696" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-1879868696" class=3D"expand-content">
<p>rel.83: 13 minutes, 2 expected complaints (<span style=3D"line-height: 1=
.4285715;">CheckSpeciesSetSizeByMethod may complain about Human-on-Human la=
stz-new and </span> <span style=3D"line-height: 1.4285715;">ForeignKeyMaste=
rTables will complain about empty MethodLink entries (this will be deleted =
later in the merging process) )</span></p>
<p>rel.85: 20mins</p>
</div>=20
</div>=20
<p>and correct any newly detected problems</p>
</div>=20
</div> </li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-MergeDNAdata">Merge DNA data</h2=
>
<p><span style=3D"color: rgb(255,0,0);">NOTE:</span> All the runs of copy_d=
ata.pl (except the last one) should have the flag &quot;-re_enable 0&quot; =
to avoid recomputing the indices in the end of each run.</p>
<p>Running &quot;-re_enable 1&quot; will add <span style=3D"color: rgb(255,=
0,255);"> <em>at least 2 hours</em> </span>&nbsp;(rel.82) to the merging ti=
me (but it is necessary in the final product) so make sure you only do it o=
nce.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"535"><p><span>Pairwise alignme=
nts: LASTZ_NET (and, formerly, BLASTZ_NET or&nbsp;</span> <span style=3D"li=
ne-height: 1.4285715;">TRANSLATED_BLAT_NET</span> <span style=3D"line-heigh=
t: 1.4285715;">)</span></p><p>*NOTE* : For merging pw alignments involving =
haplotypes, go to the next point</p>=20
<div id=3D"expander-428792804" class=3D"expand-container">=20
<div id=3D"expander-control-428792804" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-428792804" class=3D"expand-content">
<p>These data are usually in separate production databases. You can copy th=
em using the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl script. This script requires write access to the production database =
if the dnafrag_ids need fixing. Use the flag -re_enable 0 on all calls apar=
t from the last one to avoid recomputing the indices.</p>
<p>Also, check first_release of these databases. In case it hasn't been set=
, you need to do it <strong>now</strong> on <strong>both</strong> the produ=
ction database and the master database,</p>
<p>Example:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    # for each source URL: first plug in the --from_url and add=
 --dry_run to check that the script has found the right MLSS:
$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_data.pl --reg_c=
onf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_c=
onf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET --re_enable =
0 --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara4/sf5_ggal_falb_lastz_=
73 --dry_run
&nbsp;
    # if happy, remove the --dry_run flag and run it again, preferably on t=
he farm:
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000 -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_dat=
a.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/prod=
uction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET =
--re_enable 0 --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara4/sf5_ggal=
_falb_lastz_73
</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"532"><p><span style=3D"color: =
rgb(0,51,102);"> <span style=3D"color: rgb(0,51,102);">The curious case of =
LASTZ_PATCH alignments. There is <span style=3D"color: rgb(255,0,0);"> <str=
ong>always</strong> </span> something to copy, even if there are no new pat=
ches&nbsp;</span> </span></p><p><span style=3D"color: rgb(0,51,102);"> <spa=
n style=3D"color: rgb(0,51,102);">&nbsp;</span> </span></p>=20
<div id=3D"expander-704975202" class=3D"expand-container">=20
<div id=3D"expander-control-704975202" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-704975202" class=3D"expand-content">
<p><span style=3D"color: rgb(0,51,102);"> <span style=3D"color: rgb(0,128,0=
);"> <span style=3D"color: rgb(0,51,102);"> <span style=3D"color: rgb(0,51,=
102);">You will also have to copy Human_ref_vs_Human_patches and Mouse_ref_=
vs_Mouse_patches LASTZ_PATCH alignments, but mind the source:</span> </span=
> </span> </span></p>
<p><span style=3D"color: rgb(0,51,102);"> <span style=3D"color: rgb(0,128,0=
);">If there were new patches</span>, you'll import them in a way similar t=
o other LASTZ:<br /> </span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">#First run the following pipeline to import the alignments betw=
een patches / haplotypes and primary regions.  &nbsp;
&nbsp;
init_pipeline.pl Bio::EnsEMBL::Compara::PipeConfig::ImportPatchAlignmentsTo=
Ref_conf -host comparaX
&nbsp;
#then
# note the method_link_type is LASTZ_PATCH !
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_PAT=
CH --re_enable 0 --from_url &lt;the_url_of_the_pipeline_db_from_above&gt;
</pre>=20
</div>
</div>
<p><span style=3D"color: rgb(255,0,0);">If there were no new patches</span>=
, you will still have to copy them from compara_prev, since LASTZ_PATCH ali=
gnments are automatically skipped by <a href=3D"http://populate_new_databas=
e.pl" class=3D"external-link" rel=3D"nofollow">populate_new_database.pl</a>=
 script.&nbsp;<span>You simply have to refer to the previous database as th=
e source:</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    # note the method_link_type is LASTZ_PATCH !
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_PAT=
CH --re_enable 1 --from_reg_name compara_prev
</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"302"><p>Pairwise alignments: n=
on-reference patches for the high coverage LASTZ_NET alignments. This is it=
o be used when merging pw alignments involving haplotypes.</p>=20
<div id=3D"expander-301942883" class=3D"expand-container">=20
<div id=3D"expander-control-301942883" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-301942883" class=3D"expand-content">
<p>This step is now very similar to the previous.</p>
<p>Do not forget --merge and --patch_merge options.</p>
<p>Also, if it's the last one you might want to switch keys back on</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data --merge --patch_merge</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    # first plug in the --from_url and add --dry_run to check t=
hat the script has found the right MLSS:
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET=
 --method_link_type BLASTZ_NET --method_link_type TRANSLATED_BLAT_NET --re_=
enable 1 --merge --patch_merge --from_url  mysql://ensro@compara1/mm14_last=
z_human --dry_run
&nbsp;
    # if happy, remove the --dry_run flag and run it again, preferably on t=
he farm:
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET=
 --method_link_type BLASTZ_NET --method_link_type TRANSLATED_BLAT_NET --re_=
enable 1 --merge --patch_merge --from_url  mysql://ensro@compara1/mm14_last=
z_human</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"304"><p><span>Multiple alignme=
nts: PECAN, EPO, EPO_LOW_COVERAGE, GERP_CONSTRAINED_ELEMENT, GERP_CONSERVAT=
ION_SCORE</span></p>=20
<div id=3D"expander-57106478" class=3D"expand-container">=20
<div id=3D"expander-control-57106478" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-57106478" class=3D"expand-content">
<p>These data are usually in separate production databases. You can copy th=
em using the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl script. This script requires write access to the production database =
if the dnafrag_ids need fixing or the data must be copied in binary mode (t=
his is required for conservation scores).</p>
<p>Some alignments produce conservation scores and constrained elements (ch=
eck the&nbsp;<a href=3D"/seqdb/confluence/display/EnsCom/Release+plans">Rel=
ease plans</a>) and these need to be copied separately.</p>
<p>eg</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data multiple alignment</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=
=3D5000]&quot; -M5000 \
    -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_dat=
a.pl \
    --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/produ=
ction_reg_conf.pl --to_reg_name compara_curr \
    --method_link_type EPO --method_link_type EPO_LOW_COVERAGE --method_lin=
k_type PECAN \
    --method_link_type GERP_CONSTRAINED_ELEMENT --method_link_type GERP_CON=
SERVATION_SCORE \
    --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara2/sf5_epo_low_8way_f=
ish_71 -re_enable 0

</pre>=20
</div>
</div>
<p>EPO alignments produce ancestral sequences and a separate core database =
which must also be copied. See below.</p>=20
<div id=3D"expander-94626358" class=3D"expand-container">=20
<div id=3D"expander-control-94626358" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-94626358" class=3D"expand-content">
<p>rel 71.<br /> 2m: kb3_hsap_ggal_lastz_71&nbsp; mlss_id=3D632<br /> 1m&nb=
sp; kb3_mmus_ggal_lastz_71&nbsp; mlss_id=3D633<br /> 1m&nbsp; kb3_ggal_mgap=
_lastz_71&nbsp; mlss_id=3D634<br /> 1m&nbsp; kb3_ggal_xtro_tblat_71&nbsp; m=
lss_id=3D638<br /> 1m&nbsp; kb3_hsap_ggal_tblat_71&nbsp; mlss_id=3D637<br /=
> 1m&nbsp; sf5_olat_gmor_lastz_71&nbsp; mlss_id=3D625<br /> 3m&nbsp; kb3_pe=
can_20way_71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mlss_id=3D630<br /> 4m&nbsp; kb3=
_pecan_20way_71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mlss_id=3D631<br /> 35m&nbsp;=
 kb3_pecan_20way_71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mlss_id=3D50045<br /> 3m&=
nbsp; sf5_compara_epo_6way_71 mlss_id=3D548<br /> 1m&nbsp; sf5_olat_onil_la=
stz_71&nbsp; mlss_id=3D626<br /> 1m&nbsp; sf5_olat_xmac_lastz_71&nbsp; mlss=
_id=3D627<br /> 1m&nbsp; sf5_epo_low_8way_fish_71 mlss_id=3D628<br /> 2m&nb=
sp; sf5_epo_low_8way_fish_71 mlss_id=3D629<br /> 9m&nbsp; sf5_epo_low_8way_=
fish_71 mlss_id=3D50044<br /> 1m&nbsp; kb3_ggal_drer_tblat_71&nbsp;&nbsp; m=
lss_id=3D639<br /> 1m&nbsp; kb3_ggal_csav_tblat_71&nbsp;&nbsp; mlss_id=3D64=
0<br /> 1m&nbsp; sf5_ggal_acar_lastz_71&nbsp;&nbsp; mlss_id=3D636<br /> 91m=
&nbsp; sf5_ggal_tgut_lastz_7&nbsp;&nbsp;&nbsp; mlss_id=3D635 (re-enable 1)<=
br /> 93m&nbsp; sf5_compara_epo_3way_birds_71 mlss_id=3D641 (re-enable 1)<b=
r /> 14m&nbsp; sf5_compara_epo_3way_birds_71 mlss_id=3D642 (re-enable 1)<br=
 /> 16m&nbsp; sf5_compara_epo_3way_birds_71 mlss_id=3D50046 (re-enable 1)</=
p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"463"><p>Check the keys have be=
en re-enabled</p>=20
<div id=3D"expander-927865125" class=3D"expand-container">=20
<div id=3D"expander-control-927865125" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-927865125" class=3D"expand-content">
<p>Use mysqlshow to highlight if the table still has disabled keys. The tex=
t &quot;disabled&quot; will be shown in the Comment column if the key is di=
sabled. An empty Comment column indicates the keys are enabled.</p>
<p>mysqlshow interprets any underscores in the last argument as a wildcard =
so to get round this, we need to use % as the last argument.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>mysqlshow</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG compara_curr --executable mysqlshow  -- =
--keys  genomic_align_block %
db_cmd.pl $COMPARA_REG compara_curr --executable mysqlshow -- --keys genomi=
c_align %
db_cmd.pl $COMPARA_REG compara_curr --executable mysqlshow  -- --keys  geno=
mic_align_tree %
db_cmd.pl $COMPARA_REG compara_curr --executable mysqlshow  -- --keys  cons=
ervation_score %
db_cmd.pl $COMPARA_REG compara_curr --executable mysqlshow  -- --keys  cons=
trained_element %</pre>=20
</div>
</div>
<p>If there are still tables with keys disabled run the following on them:<=
/p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">db_cmd.pl $COMPARA_REG compara_curr -sql &quot;ALTER TABLE &lt;t=
able_name&gt; ENABLE KEYS&quot;;</pre>=20
</div>
</div>
</div>=20
</div> <p><span>&nbsp;</span> <span> <br /> </span></p></li>=20
<li class=3D"checked" data-inline-task-id=3D"522"><p><span>Syntenies</span>=
</p>=20
<div id=3D"expander-1230242186" class=3D"expand-container">=20
<div id=3D"expander-control-1230242186" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1230242186" class=3D"expand-content">
<p>First make sure the entries in $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scr=
ipts/pipeline/production_reg_conf.pl file point at the latest (staging) ver=
sions of the core databases.</p>
<p>Before running the code... Ensure that you check the synteny coverage an=
d if it is less than 1%, It must be deleted from mlss, mlss_tag, dnafrag_re=
gion and synteny_region tables. **This should be automated in the synteny p=
ipeline by release 84.</p>
<p>Example</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>load synteny data</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_dat=
a.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/prod=
uction_reg_conf.pl --to_reg_name compara_curr --method_link_type SYNTENY --=
from_url mysql://ensro@compara1/cc21_synteny_83 --dry_run
$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_data.pl --reg_c=
onf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_c=
onf.pl --to_reg_name compara_curr --method_link_type SYNTENY --from_url mys=
ql://ensro@compara1/cc21_synteny_83 </pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"530"><p><span>Build a new ance=
stral sequence core database</span></p>=20
<div id=3D"expander-1488670408" class=3D"expand-container">=20
<div id=3D"expander-control-1488670408" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1488670408" class=3D"expand-content">
<p>Putting together the database of ancestral sequence is now done using a =
dedicated Hive-Core mini-pipeline.</p>
<p>Check you have the most recent core checkout ie the correct schema and p=
atch files are added to the meta table.</p>
<p>&nbsp;&nbsp;&nbsp; Go to $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/modules/B=
io/EnsEMBL/Compara/PipeConfig and open the PipeConfig file AncestralMerge_c=
onf.pm .</p>
<p>&nbsp;&nbsp;&nbsp; Make sure you have edited/checked the following:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1) current release number</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2) names and locations of cur=
rent and previous ancestral core databases</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3) the table of ancestral seq=
uence sources in the second analysis (some entries might point to the previ=
ous release ancestral database, some will be new)</p>
<p>&nbsp;&nbsp;For (3), you can run the following query on your release dat=
abase and on the previous database: (NB: method_link_id=3D13 is equivalent =
to method_link_type =3D &quot;EPO&quot;)</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>EPO query</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">SELECT * FROM method_link_species_set WHERE method_link_id =3D =
13; </pre>=20
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The new mlss_id should be attached to the=
ir production database:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p; '641' =3D&gt; '<a rel=3D"nofollow">mysql://ensadmin:$ENSADMIN_PSW@compar=
a3/sf5_3birds_ancestral_sequences_core_71</a>' <br />&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp; The mlss_id that are reused should be linked to the previous datab=
ase<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '505' =3D&gt; $se=
lf-&gt;o('prev_ancestral_db'),</p>
<p>The current (as or rel.75) list of ancestral alignments are:</p>
<p>5 teleost fish<br /> 6 primates<br /> 4 sauropsids (&quot;birds&quot;)<b=
r /> 15 eutherian mammals</p>
<p>Save the changes, exit the editor and run init_pipeline.pl with this fil=
e:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl AncestralMerge_conf.pm -host compara5</pre>=20
</div>
</div>
<p>Then run both -sync and -loop variations of the beekeeper.pl command sug=
gested by init_pipeline.pl . This pipeline will merge the separate ancestra=
l core sources into ensembl_ancestral_{rel_number}.</p>
<p>You may want to check the msg table for errors and have a look at the re=
sult of the merger:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Which Ancestral sequences do we have?</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">SELECT left(name,12) na, count(*), min(seq_region_id), max(seq_=
region_id), max(seq_region_id)-min(seq_region_id)+1 FROM seq_region GROUP B=
Y na;</pre>=20
</div>
</div>
<p>If everything is ok,&nbsp;measure the time:</p>
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>how much time did running of the pipeline take?</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">call time_analysis('%')&nbsp;</pre>=20
</div>
</div>=20
<div id=3D"expander-413918862" class=3D"expand-container">=20
<div id=3D"expander-control-413918862" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-413918862" class=3D"expand-content">
<p>rel.67: 20min<br />rel.71: 20min<br />rel.75: 21min</p>
</div>=20
</div>=20
<p>Then drop hive-specific tables:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>drop hive tables</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">CALL drop_hive_tables;</pre>=20
</div>
</div>
<p>Make sure all tables are myISAM.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">&nbsp;SHOW TABLE STATUS where engine !=3D 'MyISAM';</pre>=20
</div>
</div>
</div>=20
</div> <p>or, if no new multiple alignments were run, copy it over from the=
 previous release</p>=20
<div id=3D"expander-124933221" class=3D"expand-container">=20
<div id=3D"expander-control-124933221" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-124933221" class=3D"expand-content">
<p>Create a new database for ancestral sequences:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">&nbsp;db_cmd.pl $COMPARA_REG ancestral_curr -reg_type core -sql =
'CREATE DATABASE'</pre>=20
</div>
</div>
<p>Copy over the data from the previous release:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">&nbsp;time db_cmd.pl $COMPARA_REG ancestral_prev -reg_type core =
-executable mysqldump | db_cmd.pl $COMPARA_REG ancestral_curr -reg_type cor=
e
# took 45 minutes in rel.81
# took 42 minutes in rel.82
# took 38 minutes in rel.83
# took 38 minutes in rel.84
# rel.85: 40mins</pre>=20
</div>
</div>
<p>Patch the database to the current release by applying the relevant patch=
es from $ENSEMBL_CVS_ROOT_DIR/ensembl/sql or use a schema patcher script.</=
p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/schema_patcher.pl --h=
ost=3Dcompara5 --user=3Densadmin --pass=3D${ENSADMIN_PSW} --database=3Dlg4_=
ensembl_ancestral_${CURR_ENSEMBL_RELEASE}</pre>=20
</div>
</div>
<p>If patches were applied, make sure you have both analyzed and optimized =
the tables:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG ancestral_curr -reg_type core -executabl=
e mysqlanalyze  --verbose
db_cmd.pl $COMPARA_REG ancestral_curr -reg_type core -executable mysqloptim=
ize  --verbose</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-MergeGeneTrees+Families+NCTrees+=
PatchProjectionsAsHomologies">Merge GeneTrees+Families+NCTrees+PatchProject=
ionsAsHomologies</h2>
<p>&nbsp;</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"141">Check that Protein-trees =
have been run and handed-over&nbsp; (&quot;<em>Compara hands over Homologie=
s</em>&quot; date)</li>=20
<li class=3D"checked" data-inline-task-id=3D"441">Check that ncRNA-trees ha=
ve been run</li>=20
<li class=3D"checked" data-inline-task-id=3D"442">Check that Families have =
been run</li>=20
<li class=3D"checked" data-inline-task-id=3D"425"><p>Check that LRGs were i=
ncluded in the Families</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"531"><p>Once Production has up=
dated all the xrefs (incl. gene names and descriptions), the pipeline that =
merges the gene side (&nbsp;<em> <span style=3D"line-height: 1.4285715;">Im=
portAltAlleGroupsAsHomologies_conf</span> </em>&nbsp;<span style=3D"line-he=
ight: 1.4285715;"> <span style=3D"line-height: 1.4285715;">) can be run.<br=
 />NB: make sure that all the source databases' URLs are correctly register=
ed in the master_db's MLSS table (if the pipelines have moved in between, m=
ake sure to edit the relevant MLSS.url columns).<br /> </span> </span></p>=
=20
<div id=3D"expander-871597746" class=3D"expand-container">=20
<div id=3D"expander-control-871597746" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details and times</span>=
=20
</div>=20
<div id=3D"expander-content-871597746" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>checking the URLs</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl -reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scrip=
ts/pipeline/production_reg_conf.pl -reg_alias compara_master -sql &quot;SEL=
ECT mlss.* FROM method_link_species_set mlss JOIN method_link ml USING (met=
hod_link_id) WHERE ml.type IN ('FAMILY', 'PROTEIN_TREES', 'NC_TREES') AND f=
irst_release IS NOT NULL AND last_release IS NULL&quot;</pre>=20
</div>
</div>
<p>&nbsp;</p>
<p>Now initialize and run the <em> <span>ImportAltAlleGroupsAsHomologies_co=
nf</span> </em> <span> pipeline.</span></p>
<p><span>Running times:</span></p>
<p>rel.81 : 1h03m</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"499"><p><span>Run the Hive pip=
eline ( <em>EnsemblMergeDBsIntoRelease_conf</em> )&nbsp;to merge tables fro=
m all the four products into the release database<br /> </span></p>=20
<div id=3D"expander-300287688" class=3D"expand-container">=20
<div id=3D"expander-control-300287688" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-300287688" class=3D"expand-content">
<p>Go to $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/modules/Bio/EnsEMBL/Compara/=
PipeConfig/Example and open the PipeConfig file EnsemblMergeDBsIntoRelease_=
conf.pm</p>
<p>&nbsp;&nbsp;&nbsp; It has&nbsp;a 'urls' hash where you will have to chan=
ge the names of the databases and possibly their locations:</p>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; master_db&nbsp;&nbsp;&nbsp; - is the main compara maste=
r<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prev_rel_db&nbsp;&nbsp; -=
 should point to the previous release database<br />&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; curr_rel_db&nbsp;&nbsp; - should point to the current r=
elease database being merged into ( not the Hive pipeline database, but pur=
ely Compara schema product )</p>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;"><br />&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp; protein_db - should point to the current GeneTree=
s pipeline database<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; family_=
db&nbsp; - should point to the current Families pipeline database<br />&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ncrna_db&nbsp;&nbsp; - should point =
to the current ncRNAtrees pipeline database<br />&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp; projection_db&nbsp;&nbsp; - should point to the current Pa=
tchProjectionsAsHomologies pipeline database.</p>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">Also choose the server =
to run the merging pipeline on ( you don't need a lot of resources or memor=
y, as it is purely Hive book-keeping ) and set the 'host' default_option.</=
p>
<p>&nbsp;&nbsp;&nbsp; Save the changes, exit the editor, init and run the m=
erging pipeline with this file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>running the merging pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl EnsemblMergeDBsIntoRelease_conf.pm
beekeeper.pl ... -sync
beekeeper.pl ... -loop</pre>=20
</div>
</div>
<p>&nbsp;&nbsp;&nbsp; This pipeline will merge all the protein-side product=
s into the release database.</p>
<p>&nbsp;</p>=20
<div id=3D"expander-299760721" class=3D"expand-container">=20
<div id=3D"expander-control-299760721" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-299760721" class=3D"expand-content">
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;rel.73 was the first experimental run, code had to =
be fixed, servers had to be reconfigured, so merging took one whole working=
 day.</p>
<p>In the merging database run: call time_analysis('%');</p>
<p>rel.75 : 5 hours<br />rel.76 : 5.6 hours</p>
<p>...</p>
<p>rel.82 : 6.1 hours</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"507"><p>Load the species-trees=
 (needed for <a href=3D"http://www.ensembl.org/info/about/speciestree.html"=
 class=3D"external-link" rel=3D"nofollow">the Species-tree view</a>)</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">$ init_pipeline.pl Bio::EnsEMBL::Compara::PipeConfig::LoadSpeci=
esTrees_conf -compara_alias_name compara_curr -host compara5
# Then run beekeeper as suggested by init_pipeline.pl</pre>=20
</div>
</div><p># Note: the last analysis of this pipeline failed in rel.82 (all 4=
 jobs of this analysis) trying to insert duplicated entries into MLSS_tag t=
able, but all the data was there, so I just carried on. same in rel.85</p><=
p>&nbsp;</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"510"><p><span style=3D"color: =
rgb(112,112,112);">Drop the three databases used for merging.</span></p>=20
<div id=3D"expander-1014015914" class=3D"expand-container">=20
<div id=3D"expander-control-1014015914" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1014015914" class=3D"expand-content">
<p>&nbsp;</p>
<div>
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">=09# After you are happy about the result of protein side mergi=
ng you can drop the &quot;YourName_homology_projections_ThisRelease&quot; d=
atabase.
$ db_cmd.pl -url mysql://ensadmin:${ENSADMIN_PSW}@compara5/lg4_homology_pro=
jections_${CURR_ENSEMBL_RELEASE} -sql 'drop database'
&nbsp;
=09# same for the LoadSpeciesTrees database:
$ db_cmd.pl -url mysql://ensadmin:${ENSADMIN_PSW}@compara5/lg4_load_species=
_trees_${CURR_ENSEMBL_RELEASE} -sql 'drop database'

=09# same for the MergeDBsIntoRelease database:
$ db_cmd.pl -url mysql://ensadmin:${ENSADMIN_PSW}@compara5/lg4_pipeline_dbm=
erge_${CURR_ENSEMBL_RELEASE} -sql 'drop database'</pre>=20
</div>
</div>
</div>
</div>=20
</div> </li>=20
<li data-inline-task-id=3D"509"><p><span style=3D"line-height: 1.4285715;">=
git commit the changes to the PipeConfig files that you have made.</span></=
p></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Finaldatabasechecks"><span>Final=
 database checks<br /> </span></h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"524"><p><span>Remove redundant=
 method_link entries</span></p>=20
<div id=3D"expander-450125669" class=3D"expand-container">=20
<div id=3D"expander-control-450125669" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-450125669" class=3D"expand-content">
<p>In most cases they can be removed, but check with other members of Compa=
ra. Remove redundant method_link entries</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>method_link entries</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">-- prepend with:     db_cmd.pl -reg_conf $ENSEMBL_CVS_ROOT_DIR/e=
nsembl-compara/scripts/pipeline/production_reg_conf.pl -reg_alias compara_c=
urr -sql
&nbsp;
SELECT ml.* FROM method_link ml LEFT JOIN method_link_species_set mlss USIN=
G(method_link_id) WHERE mlss.method_link_id IS NULL;
DELETE ml FROM method_link ml LEFT JOIN method_link_species_set mlss USING(=
method_link_id) WHERE mlss.method_link_id IS NULL;
&nbsp;
note**** we deleted 18 mlss_ids in rel.83</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"198"><p>Check that all the sch=
ema patches have been declared and applied.</p>=20
<div id=3D"expander-1364382358" class=3D"expand-container">=20
<div id=3D"expander-control-1364382358" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1364382358" class=3D"expand-content">
<p>If unsure, recheck the current schema against the previous schema. See<s=
pan> <span class=3D"confluence-link">Check the patch files</span> for detai=
ls </span></p>
</div>=20
</div> </li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Runthehealthchecks"><span>Run th=
e healthchecks</span></h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"478"><p><span>Update the code<=
/span></p>=20
<div id=3D"expander-1547306272" class=3D"expand-container">=20
<div id=3D"expander-control-1547306272" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1547306272" class=3D"expand-content">
<p>The healthchecks are written in java and need to be recompiled after a g=
it pull.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compile healthchecks</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cd $ENSEMBL_CVS_ROOT_DIR/ensj-healthcheck
export JAVA_HOME=3D/software/jdk1.6.0_14
git pull
bsub -I ant clean jar</pre>=20
</div>
</div>
<p>We don't need to configure a database.properties any more. Everything is=
 done from the command line</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"396"><p>&nbsp;Run the healthch=
ecks for ancestral database</p>=20
<div id=3D"expander-613395849" class=3D"expand-container">=20
<div id=3D"expander-control-613395849" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-613395849" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -M8000  -R&quot;select[mem&gt;8000]  rusage[mem=3D800=
0]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d sf5_ensembl_anc=
estral_77 -g ComparaAncestral</pre>=20
</div>
</div>
<p>It should take less than a minute (if the tables are analyzed / optimize=
d) and usually complains about 1 thing that you can ignore:</p>
<div class=3D"preformatted panel" style=3D"border-width: 1px;">
<div class=3D"preformattedContent panelContent">=20
<pre>org.ensembl.healthcheck.testcase.generic.AssemblySeqregion [Team respo=
nsible: GENEBUILD]
  mm14_ensembl_ancestral_80: 0 rows found in assembly table</pre>=20
</div>
</div>=20
<div class=3D"aui-message warning shadowed information-macro">=20
<span class=3D"aui-icon icon-warning">Icon</span>=20
<div class=3D"message-content">=20
<p>If healthcheck indicates that tables need to be analysed, follow instruc=
tions here: <a href=3D"/seqdb/confluence/pages/viewpage.action?pageId=3D309=
48447">Analyze / Optimize the databases</a></p>=20
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"435"><p><span>Update the max_a=
lignment_length IF NECESSARY.</span></p>=20
<div id=3D"expander-1328793643" class=3D"expand-container">=20
<div id=3D"expander-control-1328793643" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1328793643" class=3D"expand-content">
<p>Check that the max_alignment_lengths have been computed.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update max_alignment_length</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagMax=
Align</pre>=20
</div>
</div>
<p>If not (the healthcheck is failing), you can repair it by adding the --r=
epair flag:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update max_alignment_length</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagMax=
Align --repair 1 --user ensadmin --password $ENSADMIN_PSW</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"386"><p>Update the alignment m=
lss_id of the conservation score IF NECESSARY</p>=20
<div id=3D"expander-653383132" class=3D"expand-container">=20
<div id=3D"expander-control-653383132" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-653383132" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update conservation score mlss_id</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagGER=
PMSA</pre>=20
</div>
</div>
<p>If the healthcheck is failing, you can repair it by adding the --repair =
flag:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update conservation score mlss_id</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagGER=
PMSA --repair 1 --user ensadmin --password $ENSADMIN_PSW</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"436"><p>Run the ComparaAll gro=
up of healthchecks on the release database</p>=20
<div id=3D"expander-1107221638" class=3D"expand-container">=20
<div id=3D"expander-control-1107221638" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1107221638" class=3D"expand-content">
<p>The 'stdbuf -o0' is a trick to prevent the pipe from buffering the outpu=
t, since in addition to storing it we also want to examine the output visua=
lly.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compara_external_foreign_keys</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rus=
age[mem=3D8000]&quot; -I stdbuf -o0 ./run-configurable-testrunner.sh -h com=
para5 -d lg4_ensembl_compara_81 --host2 ens-staging2 -g ComparaAll | tee he=
althchecks_after_merge.txt</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"526"><p>Run the ControlledComp=
araTables group of healthchecks on the release database</p>=20
<div id=3D"expander-1160814569" class=3D"expand-container">=20
<div id=3D"expander-control-1160814569" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1160814569" class=3D"expand-content">
<p>The 'stdbuf -o0' is a trick to prevent the pipe from buffering the outpu=
t, since in addition to storing it we also want to examine the output visua=
lly.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compara_external_foreign_keys</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rus=
age[mem=3D8000]&quot; -I stdbuf -o0 ./run-configurable-testrunner.sh -h com=
para5 -d lg4_ensembl_compara_81 --host2 compara1 --compara_master.database =
mm14_ensembl_compara_master -g ControlledComparaTables | tee healthchecks_c=
ontrolled_tables_after_merge.txt</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"527"><p>&nbsp;</p></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Testwebserver">Test web server</=
h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"185"><span>Ask ensembl-product=
ion to point the test web server to the compara release database</span> <br=
 /> <span>Upon confirmation from the release coordinator ask other members =
of Compara to check their data on:<br />&nbsp;&nbsp;&nbsp; <a href=3D"http:=
//staging.ensembl.org/" class=3D"external-link" rel=3D"nofollow">http://sta=
ging.ensembl.org/</a> <br /> </span></li>=20
</ul>=20
<p>&nbsp;</p>
<h2 id=3D"Releasecoordinationdocumentation-Finalhandoverofdatabases[edit]">=
Final handover of databases <a href=3D"https://www.ebi.ac.uk/seqdb/confluen=
ce/pages/editpage.action?pageId=3D30948157" rel=3D"nofollow">[edit]</a></h2=
>
<p></p>
<h3 id=3D"Releasecoordinationdocumentation-Analyze/Optimizeonelasttime">Ana=
lyze / Optimize one last time</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"30948157">=
=20
<li class=3D"checked" data-inline-task-id=3D"11"><p>This is required for th=
e CopyDbOverServer script to work properly.</p>=20
<div id=3D"expander-184472480" class=3D"expand-container">=20
<div id=3D"expander-control-184472480" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-184472480" class=3D"expand-content">
<p></p>
<ol>
<li><p>Run ANALYZE_TABLE on compara and ancestral databases</p>=20
<div id=3D"expander-1345576243" class=3D"expand-container">=20
<div id=3D"expander-control-1345576243" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1345576243" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>analyze table</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time db_cmd.pl $COMPARA_REG compara_curr   -executable mysqlana=
lyze --verbose
time db_cmd.pl $COMPARA_REG ancestral_curr -reg_type core -executable mysql=
analyze --verbose</pre>=20
</div>
</div>
</div>=20
</div> </li>
<li><p>Run OPTIMIZE_TABLE on compara and ancestral databases</p>=20
<div id=3D"expander-637627785" class=3D"expand-container">=20
<div id=3D"expander-control-637627785" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-637627785" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>optimize table</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time db_cmd.pl $COMPARA_REG compara_curr   -executable mysqlopt=
imize --verbose
time db_cmd.pl $COMPARA_REG ancestral_curr -reg_type core -executable mysql=
optimize --verbose</pre>=20
</div>
</div>
</div>=20
</div> </li>
</ol>
<p>Both operations will take between a few seconds and a few hours, dependi=
ng on the state of the tables / indexes</p>
<p></p>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Copydatabasestostagingservers">C=
opy databases to staging servers</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"30948157">=
=20
<li class=3D"checked" data-inline-task-id=3D"3"><p>Logon to ens-staging1 an=
d import the databases</p>=20
<div id=3D"expander-891169109" class=3D"expand-container">=20
<div id=3D"expander-control-891169109" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-891169109" class=3D"expand-content">
<p>The import script MUST be run on the DESTINATION machine with the <em>my=
sqlens</em> user. NB: ask for the password for <em>mysqlens</em> well in ad=
vance - there may be no-one around you at the right moment!<br />You should=
 also check whether there is enough space (~270Gb) on the disk before start=
ing the copy.</p>
<p>The script assumes that your environment is set ($ENSEMBL_CVS_ROOT_DIR a=
nd $ENSADMIN_PSW)</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">ssh ens-staging1
df -h /mysql
su -m -c $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/production/import_co=
mpara_release_databases.pl mysqlens</pre>=20
</div>
</div>
<p>It should take 1h30-2h to run</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"4"><p>Logon to ens-staging2 an=
d import the databases (same procedure)</p></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Filehandover">File handover</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"30948157">=
=20
<li class=3D"checked" data-inline-task-id=3D"12"><span>If we have generated=
 a new &quot;Age of Base&quot; file, it has to be copied to /nfs/ensnfs-dev=
/staging/homo_sapiens/GRCh38/compara/ (usually it's named Hsap_ages_${mlss_=
id}_${release_number}.bb ).<br />Llet the web-team know if you have copied =
a new file or if they should consider the <span>file from the previous rele=
ase </span>.<br /></span></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Finalbits">Final bits</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"30948157">=
=20
<li class=3D"checked" data-inline-task-id=3D"8"><p>Send an email to <a href=
=3D"/seqdb/confluence/display/EnsCom/Final+handover+of+databases">ensembl-p=
roduction</a> to announce the handover the databases and cc ensembl-compara=
@</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"6"><p>Update the Declaration o=
f Intentions on the <a href=3D"http://admin.ensembl.org/index.html" class=
=3D"external-link" rel=3D"nofollow">admin website</a> to indicate what has =
been handed over and what didn't make it and has been postponed</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"419"><p>Dump the master databa=
se and place the copy in a safe place</p>=20
<div id=3D"expander-1633414673" class=3D"expand-container">=20
<div id=3D"expander-control-1633414673" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1633414673" class=3D"expand-content">
<p>It should take a couple of minutes at most to run:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>dump master database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG compara_master --executable mysqldump | =
gzip - &gt; /warehouse/ensembl01/compara/master_dumps/ensembl_compara_maste=
r_${RELEASE_VERSION}.mysql.gz</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<p>&nbsp;</p>
<p></p>
<h1 id=3D"Releasecoordinationdocumentation-Post-handover">Post-handover</h1=
>
<h2 id=3D"Releasecoordinationdocumentation-Updatedocumentationanddiagrams[e=
dit]">Update documentation and diagrams <a href=3D"https://www.ebi.ac.uk/se=
qdb/confluence/pages/editpage.action?pageId=3D32180001" rel=3D"nofollow">[e=
dit]</a></h2>
<p> </p>
<div class=3D"aui-message hint shadowed information-macro">=20
<span class=3D"aui-icon icon-hint">Icon</span>=20
<div class=3D"message-content">
 It is now time to update the static files. This should be done before we b=
ranch the code=20
</div>=20
</div>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"32180001">=
=20
<li class=3D"checked" data-inline-task-id=3D"463"><p>Update the pipeline di=
agrams for all the pipelines that have been run this release</p>=20
<div id=3D"expander-453616060" class=3D"expand-container">=20
<div id=3D"expander-control-453616060" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-453616060" class=3D"expand-content">
<p>Go to the docs directory</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>pipeline diagrams</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cd $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/pipelines/diagram=
s
generate_graph.pl $COMPARA_REG compara_ptrees -output ProteinTrees.png
generate_graph.pl $COMPARA_REG compara_nctrees -output ncRNAtrees.png
generate_graph.pl $COMPARA_REG compara_families -output Families.png
generate_graph.pl -url mysql://ensro@compara3/kb3_pecan_20way_71 -output Me=
rcatorPecan.png
generate_graph.pl -url mysql://ensro@compara4/sf5_epo_35way_68 -output EpoL=
owCoverage.png
generate_graph.pl -url mysql://ensro@compara4/sf5_compara_epo_13way_69 -out=
put epo_pt3.png</pre>=20
</div>
</div>
<p>Commit any changed diagrams to git and push.</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"414"><p>Update the schema docu=
mentation and diagrams</p>=20
<div id=3D"expander-1760636291" class=3D"expand-container">=20
<div id=3D"expander-control-1760636291" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1760636291" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>generate new schema documentation</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-production/scripts/sql2html.=
pl -i $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/sql/table.sql -o $ENSEMBL_CVS_R=
OOT_DIR/ensembl-compara/docs/schema/compara_schema.html -d Compara -host co=
mpara5 -user ensro -dbname lg4_ensembl_compara_75 -sort_headers 0 -sort_tab=
les 0 -intro $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/intro.html</=
pre>=20
</div>
</div>
<p>Open the output file $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/c=
ompara_schema.html in your browser and check that no example errors are rep=
orted.</p>
<p>If everything looks fine, copy this file to public-plugins and commit&am=
p;push both (the compara one and the webcode one) :</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update schema documentation for web</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cp $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/compara_sc=
hema.html $ENSEMBL_CVS_ROOT_DIR/public-plugins/docs/htdocs/info/docs/api/co=
mpara/</pre>=20
</div>
</div>
<p>If necessary, update schema diagrams by loading the $ENSEMBL_CVS_ROOT_DI=
R/ensembl-compara/sql/table.sql schema file into MySQL Workbench, rearrange=
/colour the nodes and export into PNG.</p>
<p>The schema diagrams will have to be copied both to $ENSEMBL_CVS_ROOT_DIR=
/ensembl-compara/docs/schema/diagrams and to public-plugins and committed&a=
mp;pushed in both repositories:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update schema diagrams for web</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cp -r $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/diagram=
s/*.png $ENSEMBL_CVS_ROOT_DIR/public-plugins/docs/htdocs/info/docs/api/comp=
ara/diagrams/</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"462"><p>Update the API tutoria=
l documentation</p>=20
<div id=3D"expander-854335016" class=3D"expand-container">=20
<div id=3D"expander-control-854335016" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-854335016" class=3D"expand-content">
<p>Update the tutorial documentation compara_tutorial.html in this director=
y:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ENSEMBL_CVS_ROOT_DIR/ensembl-webco=
de/htdocs/info/docs/api/compara/</p>
<p>Be careful that the embedded Perl snippets must use HTML-escaped charact=
ers (e.g. &amp;lt; and &amp;gt;) and be wrapped in a &lt;pre class=3D&quot;=
code sh_perl&quot;&gt;</p>
<p>Open the URL /info/docs/api/compara/compara_tutorial.html from a sandbox=
 / test website and export it as a PDF in</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ENSEMBL_CVS_ROOT_DIR/ensembl-compa=
ra/docs/ComparaTutorial.pdf</p>
<p>To make the pdf look nicer, you can issue a few JavaScript commands to r=
emove the Ensembl headers. See <a href=3D"/seqdb/confluence/display/EV/Crea=
ting+PDF+version+of+VEP+docs">Creating PDF version of VEP docs</a> for more=
 details</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"464"><p>Update the tutorial ab=
out Compara resources</p>=20
<div id=3D"expander-1830287462" class=3D"expand-container">=20
<div id=3D"expander-control-1830287462" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1830287462" class=3D"expand-content">
<p>Do the same with $ENSEMBL_CVS_ROOT_DIR/ensembl-webcode/htdocs/info/websi=
te/tutorials/compara.html&nbsp;. This pages can be viewed online at <a href=
=3D"http://staging.ensembl.org/info/website/tutorials/compara.html" class=
=3D"external-link" rel=3D"nofollow"> http://staging.ensembl.org/info/websit=
e/tutorials/compara.html </a></p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"465"><p>Update main ensembl sp=
ecies tree if there are any new species</p><p>See&nbsp;$ENSEMBL_CVS_ROOT_DI=
R/ensembl-compara/docs/species_tree/README</p><p>The end result should go h=
ere (check how it should be moved) :&nbsp;<a href=3D"http://www.ensembl.org=
/info/about/species_tree.pdf" class=3D"external-link" rel=3D"nofollow">http=
://www.ensembl.org/info/about/species_tree.pdf</a></p></li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"32180001">=
=20
<li class=3D"checked" data-inline-task-id=3D"210">Check examples work in en=
sembl-compara/scripts/examples/</li>=20
<li class=3D"checked" data-inline-task-id=3D"286">git commit and push any m=
odified files or added tutorial examples</li>=20
<li class=3D"checked" data-inline-task-id=3D"426"><p>Update the declared in=
tention with removed / deprecated methods</p>=20
<div id=3D"expander-619587484" class=3D"expand-container">=20
<div id=3D"expander-control-619587484" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click for details</span>=20
</div>=20
<div id=3D"expander-content-619587484" class=3D"expand-content">
<p>We need to generate the list of methods exported by the objects / adapto=
rs on the master and release/{$n-1} branches, and compare (diff) them.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Check deprecated / removed methods</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;"># on master/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; *pm | sort &gt; ~/MASTER
# on the previous release/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; *pm | sort &gt; ~/RELEASE75
sdiff -w 200 -bs ~/RELEASE75 ~/MASTER | less

# Let's do the same for the adaptors
# on master/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; DBSQL/*pm | sort &gt; ~/MASTER
# on the previous release/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; DBSQL/*pm | sort &gt; ~/RELEASE75
sdiff -w 200 -bs ~/RELEASE75 ~/MASTER | less

</pre>=20
</div>
</div>
<p>In both cases, make sure the methods are really removed, and not moved t=
o a base / sub class, etc</p>
</div>=20
</div> </li>=20
</ul>=20
<p></p>
<h2 id=3D"Releasecoordinationdocumentation-Branchthecode">Branch the code</=
h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"525"><p>Check with the rest of=
 Compara that it is ok to branch the code as it is, then create the 'releas=
e/THIS_RELEASE_NUMBER' branch in git and push it to the server.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cd $ENSEMBL_CVS_ROOT_DIR/ensembl-compara
git pull master
git branch release/&lt;release number&gt;
git checkout release/&lt;release number&gt;
git push origin release/&lt;release number&gt;</pre>=20
</div>
</div></li>=20
</ul>=20
<h2 id=3D"Releasecoordinationdocumentation-Datadumps"><a href=3D"/seqdb/con=
fluence/display/EnsCom/Data+dumps">Data dumps</a></h2>
<p>** All dumps to be done by the release coordinator!!!</p>
<p>These should only be done once ensembl-production has given the go-ahead=
 for this. This is to avoid overloading the databases whilst biomart is bei=
ng run.</p>
<p>Most dumps (except homology) are currently generated in /lustre/scratchX=
XX areas and then have to be manually assembled into the&nbsp;/nfs/ensembl/=
ensembl/ftp_ensembl/release-XX/ tree.<br />Look at the previous release tre=
e to get the idea. The first level of directories normally defines the file=
 type, and the second level is the team name (except fasta/ where species a=
re mixed).<br /><br />Ensembl-compara is responsible for the following dump=
s:</p>
<p style=3D"margin-left: 30.0px;">bed/ensembl-compara (MSA)<br />emf/ensemb=
l-compara (MSA and homologies)<br />maf/ensembl-compara (multiple_alignment=
s and pairwise_alignments)<br />xml/ensembl-compara (homologies)<br />fasta=
/<span>ancestral_alleles (the only one without ensembl-compara in the path)=
</span></p>
<p><span>&nbsp;</span><span style=3D"line-height: 1.4285715;">Make sure the=
y are all either generated by running new dumps,&nbsp;</span><span style=3D=
"line-height: 1.4285715;">or if some MSAs did not run in this release - sym=
-linked from the previous release's &nbsp;</span><span style=3D"line-height=
: 1.4285715;">/warehouse/ens_ftp_arch_03/release-Xx/ tree.</span></p>
<p>DO NOT LINK OR COPY FROM PREVIOUS RELEASE's /lustre/scratch areas, as th=
ey may no longer point to real data!!!<br />If you do not have enough permi=
ssions for reading from&nbsp;/warehouse/ens_ftp_arch_03/release-Xx/ talk to=
 the web-team and ask for it to be fixed.</p>
<p>&nbsp;</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"32179500">=
=20
<li class=3D"checked" data-inline-task-id=3D"463"><span>DNA data dumps</spa=
n> <br /><span>The instructions are in $ENSEMBL_CVS_ROOT_DIR/ensembl-compar=
a/docs/pipelines/READMEs/multi_align.dumps.txt</span>&nbsp;<br /><span>&nbs=
p;</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"466"><p><span>Gene tree dumps<=
/span> <br /><span>&nbsp;</span></p>=20
<div id=3D"expander-1068373949" class=3D"expand-container">=20
<div id=3D"expander-control-1068373949" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1068373949" class=3D"expand-content">
<p>Go to $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/modules/Bio/EnsEMBL/Compara/=
PipeConfig and open the PipeConfig file DumpTrees_conf.pm</p>
<p>Check that you are happy about all parameters. In usual cases, they can =
all be set from the command line and the config file does not need editing.=
</p>
<p>Make sure you have the XML::Writer module in your PERL5LIB (there is a c=
opy in ~mm14/src/perl/orthoxml/)</p>
<p>Run init_pipeline.pl with this file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipelline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl DumpTrees_conf.pm -host compara5 -member_type =
protein</pre>=20
</div>
</div>=20
<div class=3D"aui-message problem shadowed information-macro">=20
<span class=3D"aui-icon icon-problem">Icon</span>=20
<div class=3D"message-content">=20
<p>rel.64: testing sqlite mode failed: too many occurrences of &quot;databa=
se locked&quot;. We should stick to mysql or significantly reduce the analy=
sis_capacities.</p>=20
</div>=20
</div>=20
<p>Then run the beekeeper.pl -loop command suggested by init_pipeline.pl . =
<span style=3D"line-height: 1.4285715;">This pipeline took 2h8m to run in r=
el82.</span></p>
<p>It will produce protein_tree dumps in the directory pointed at by 'targe=
t_dir' parameter. ('/lustre/scratch110/ensembl/'.$self-&gt;o('ENV', 'USER')=
.'/'.$self-&gt;o('pipeline_name'))</p>
<p>It also automatically copies the file to /nfs/ensembl/ensembl/ftp_ensemb=
l/release-XX/, so just check that the files are there with correct sizes, a=
nd you're done.</p>
<p>&nbsp;</p>
<p>Create the ncRNA pipeline from the same config file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl DumpTrees_conf.pm -host compara5 -member_type =
ncrna</pre>=20
</div>
</div>
<p>&nbsp;<span>Then run the beekeeper.pl -loop command suggested by init_pi=
peline.pl . </span><span>This pipeline took 36m to run in rel82.</span></p>
<p>&nbsp;This pipeline will produce ncrna_tree dumps in the directory point=
ed at by 'target_dir' parameter and copy them to /nfs/ensembl/ensembl/ftp_e=
nsembl/release-XX/.</p>
<p>&nbsp;</p>
<p>Commit the DumpTrees_conf.pm file into git if you'd like to keep the cha=
nges.</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"467"><p>Copy the tree content =
dump for Uniprot</p>=20
<div id=3D"expander-27074029" class=3D"expand-container">=20
<div id=3D"expander-control-27074029" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-27074029" class=3D"expand-content">
<p>The file 'target_dir'/ensembl.GeneTree_content.{release}.txt.gz needs to=
 be copied to the EBI ftp server, and then MD5 checksum computed and stored=
 next to it:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">scp /lustre/scratch110/ensembl/lg4/protein_81_dumps/ensembl.Gen=
eTree_content.e81.txt.gz #change the files &amp; user for release you are w=
orking on.
login.ebi.ac.uk:/nfs/ftp/pub/databases/ensembl/ensembl_compara/gene_trees_f=
or_uniprot
ssh login.ebi.ac.uk #login to ebi
cd /nfs/ftp/pub/databases/ensembl/ensembl_compara/gene_trees_for_uniprot
md5sum ensembl.GeneTree_content.e&lt;CURR_RELEASE_NUMBER&gt;.txt.gz &gt; en=
sembl.GeneTree_content.e&lt;CURR_RELEASE_NUMBER&gt;.txt.gz.MD5SUM</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"431"><p>Ancestral alleles (for=
 the Variation team)</p>=20
<div id=3D"expander-1962167292" class=3D"expand-container">=20
<div id=3D"expander-control-1962167292" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1962167292" class=3D"expand-content">=20
<div class=3D"aui-message hint shadowed information-macro">=20
<span class=3D"aui-icon icon-hint">Icon</span>=20
<div class=3D"message-content">=20
<p>Ancestral alleles are computed from EPO data. These can be symlinked fro=
m /warehouse/ens_ftp_arch_03/release-XX if no new alignments have been run<=
/p>=20
</div>=20
</div>=20
<p>Repeat the process for each species of interest and perform a checksum w=
hen all data is tarred</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/ancestral_se=
quences/get_ancestral_sequence.pl --conf $ENSEMBL_CVS_ROOT_DIR/ensembl-comp=
ara/scripts/pipeline/production_reg_conf.pl --compara_url mysql://ensro@com=
para5/sf5_epo_8primates_77 --species homo_sapiens
dirname=3Dhomo_sapiens*
cd $dirname
perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/ancestral_sequences/get_=
stats.pl &gt; summary.txt
cd ..
tar -cvzf ${dirname}.tar.gz $dirname
md5sum *.tar.gz &gt; MD5SUM # when archives for all required species are co=
mplete</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"464">Let the production team k=
now that the dumps are ready in their common&nbsp;/nfs/ensembl/ensembl/ftp_=
ensembl/release-XX/ location.</li>=20
</ul>=20
<p></p>
<p>&nbsp;</p>
<h2 id=3D"Releasecoordinationdocumentation-PatchGRCh37Databases"><a href=3D=
"/seqdb/confluence/display/EnsCom/GRCh37+website">Patch GRCh37 Databases</a=
></h2>
<p> </p>
<div class=3D"aui-message hint shadowed information-macro">=20
<span class=3D"aui-icon icon-hint">Icon</span>=20
<div class=3D"message-content">=20
<p>For the next 10 years or so, we'll maintain a special archive site for t=
he GRCh37 assembly: <a href=3D"http://grch37.ensembl.org" class=3D"external=
-link" rel=3D"nofollow">http://grch37.ensembl.org</a></p>
<p>This page explains the procedure to update the Compara databases on it. =
This has to be done every release and is coordinated <a href=3D"/seqdb/conf=
luence/display/ENS/GRCh37+Archive+Site">with the other teams</a>.</p>=20
</div>=20
</div>=20
<h1 id=3D"Releasecoordinationdocumentation-Connectiondetails">Connection de=
tails</h1>
<p>The web-team has a Confluence page with all <a href=3D"/seqdb/confluence=
/display/ENSWEB/GRCh37+setup+and+release+process">the gory details</a>. To =
summarize:</p>
<ul>
<li>Public MySQL server: ensembldb.ensembl.org:3337</li>
<li>Internal MySQL server (where we need to update the databases):&nbsp;<sp=
an style=3D"line-height: 1.42857;">ens-staging-grch37&nbsp;</span>in e!84, =
but it may be different in future releases</li>
</ul>
<h1 id=3D"Releasecoordinationdocumentation-Case1:nodataupdates">Case 1: no =
data updates</h1>
<ul>
<li><p>Patch the ensembl_compara_<span style=3D"line-height: 1.4285715;">${=
CURR_ENSEMBL_RELEASE}&nbsp;</span><span style=3D"line-height: 1.4285715;">d=
atabase to the newest Compara schema</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/schema_patcher.pl --=
host=3Dens-staging-grch37 --user=3Densadmin --pass=3D${ENSADMIN_PSW} --data=
base=3Densembl_compara_${CURR_ENSEMBL_RELEASE}</pre>=20
</div>
</div></li>
<li><p>Patch the ensembl_ancestral_${CURR_ENSEMBL_RELEASE} database to the =
newest Core schema</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/schema_patcher.pl --=
host=3Dens-staging-grch37 --user=3Densadmin --pass=3D${ENSADMIN_PSW} --data=
base=3Densembl_ancestral_${CURR_ENSEMBL_RELEASE}</pre>=20
</div>
</div></li>
<li>That's it, you're ready to hand-over</li>
</ul>
<h1 id=3D"Releasecoordinationdocumentation-Case2:dataupdates">Case 2: data =
updates</h1>
<p>Data-updates have to be coordinated with the other teams as they can imp=
act them (BioMart, dumps, etc). The next data-update is scheduled to be for=
 e79, but Compara did not participate in it.</p>
<h1 id=3D"Releasecoordinationdocumentation-Comparaupdates:">Compara updates=
:</h1>
<ul>
<li>Upgrade of the protein trees / homologies, to merge with TreeFam. This =
will impact BioMart, etc.&nbsp;</li>
<li>Fix the CAFE data ? =E2=86=92 Actually done at a data update, but I can=
't remember which one</li>
</ul>
<p>&nbsp;</p>
<p></p>
<h2 id=3D"Releasecoordinationdocumentation-Finalthings">Final things</h2>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"420"><span>Create a word docum=
ent and a pdf dump of this document</span></li>=20
</ul>=20
<div id=3D"expander-1237636868" class=3D"expand-container">=20
<div id=3D"expander-control-1237636868" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1237636868" class=3D"expand-content">
<p>In the top-right menu of this Confluence page, choose &quot;Tools -&gt; =
Export to PDF&quot; and &quot;Tools -&gt; Export to Word&quot;.</p>
<p>Put these files into $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/producti=
on</p>
<p>git commit and push</p>
</div>=20
</div>
    </div>
</body>
</html>
------=_Part_16919_612776353.1468237655598
Content-Type: image/png
Content-Transfer-Encoding: base64
Content-Location: file:///C:/81c4be8bbc84ad58a16c9a5b9cee7752

iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAAFVBMVEX/
//9wcHBwcHBwcHBwcHBwcHBwcHA3RenHAAAAB3RSTlMAZoiZzN3/SzZomQAAAAlwSFlzAAALEgAA
CxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAUdEVYdENy
ZWF0aW9uIFRpbWUANi8xLzEzOKlF0AAAACFJREFUCJljYCATsCgwqIAZTMnMyRAhsTABCIMxkVxT
GQCLcwHyUKXpLgAAAABJRU5ErkJggg==
------=_Part_16919_612776353.1468237655598--
